import{cP as b}from"./index-EEKoSAfw.js";import{b as A}from"./utils-DJTICtwe.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";function f(r){return typeof r=="string"&&r.length>0}function B(r,t,e,n=1e-8){if(typeof r!="number")return null;const i=t-n,s=e+n;return r<i||r>s?null:Math.min(Math.max(r,t),e)}function c(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)}function V(r){switch(r){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return r.startsWith("u")?0:null}function K(r){switch(r){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}function v(r){const t={minimum:null,maximum:null},e=l=>l.minimum!==null&&l.maximum!==null,n=r.getMetadata("statistics");if(c(n)&&(typeof n.minimum=="number"&&(t.minimum=n.minimum),typeof n.maximum=="number"&&(t.maximum=n.maximum),e(t)))return t;const i=r.getMetadata("raster:histogram");if(c(i)&&(typeof i.min=="number"&&(t.minimum=i.min),typeof i.max=="number"&&(t.maximum=i.max),e(t)))return t;const s=r.getMetadata("classification:classes");if(Array.isArray(s)&&(s.reduce((l,a)=>(l.minimum=Math.min(l.minimum,a.value),l.maximum=Math.max(l.maximum,a.value),l),t),e(t)))return t;const u=r.getMetadata("file:values");if(Array.isArray(u)&&(u.reduce((l,a)=>(l.minimum=Math.min(l.minimum,...a.values),l.maximum=Math.max(l.maximum,...a.values),l),t),e(t)))return t;const o=r.getMetadata("data_type");return o&&(t.minimum=V(o),t.maximum=K(o)),t}function I(r){let t=[];const e=r.getMetadata("nodata");if(typeof e<"u")t.push(e);else{const n=r.getMetadata("file:nodata");if(typeof n<"u")t=n;else{const i=r.getMetadata("classification:classes");Array.isArray(i)&&(t=i.filter(s=>!!s.nodata).map(s=>s.value))}}return t.map(n=>n==="nan"?NaN:n==="+inf"?1/0:n==="-inf"?-1/0:n)}function p(r){let t=r.length>=6,e=r[0],n=r[t?3:2],i=r[1],s=r[t?4:3],u={west:e,east:n,south:i,north:s};return t&&(u.base=r[2],u.height=r[5]),u}function k(r){let{west:t,east:e,south:n,north:i}=p(r);return[[[t,i],[t,n],[e,n],[e,i],[t,i]]]}function H(r){if(r=h(r,!0),!r)return null;let t=p(r),e=[];if(E(r)){let n=(t.west+360+t.east)/2;n>180&&(n-=360),e.push(n)}else e.push((t.west+t.east)/2);return e.push((t.south+t.north)/2),typeof t.base<"u"&&e.push((t.base+t.height)/2),e}function z(r){if(r.every(n=>typeof n=="number")&&(r=[r]),r=r.map(n=>h(n)).filter(n=>n!==null),!Array.isArray(r)||r.length===0)return null;let t=r.reduce((n,i)=>{if(E(i)){let{west:s,east:u,south:o,north:l}=p(i);n.push(k([-180,o,u,l])),n.push(k([s,o,180,l]))}else n.push(k(i));return n},[]),e=null;if(t.length===1?e={type:"Polygon",coordinates:t[0]}:t.length>1&&(e={type:"MultiPolygon",coordinates:t}),e)return{type:"Feature",geometry:e,properties:{}}}function h(r,t=!1){if(!Array.isArray(r)||![4,6].includes(r.length))return null;let{west:e,east:n,south:i,north:s,base:u,height:o}=p(r);return e=B(e,-180,180),i=B(i,-90,90),n=B(n,-180,180),s=B(s,-90,90),t&&r.length===6?r=[e,i,u,n,s,o]:r=[e,i,n,s],r.some(l=>l===null)?null:r}function E(r){if(r=h(r),!r)return!1;let{west:t,east:e}=p(r);return t>e}function W(r){if(!Array.isArray(r)||r.length===0)return null;const t={west:null,south:null,east:null,north:null},e=["west","south"];for(let i of r){if(i=h(i),!i)continue;const s=p(i);for(const u in s)if(t[u]===null)t[u]=s[u];else{const o=e.includes(u)?Math.min:Math.max;t[u]=o(t[u],s[u])}}let n=[t.west,t.south,t.east,t.north];return h(n)}class x{constructor(t,e={},n=[]){if(!c(t))throw new Error("Given data is not an object");if(t instanceof x){for(let i of n)this[i]=t[i];t=t.toJSON()}this._keyMap=e,this._privateKeys=["_keyMap","_privateKeys"].concat(n);for(let i in t)typeof this[i]>"u"&&(i in e?this[i]=e[i](t[i],this):this[i]=t[i])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}isBand(){return!1}getObjectType(){}getAbsoluteUrl(t=!0){return null}getMetadata(t){return this[t]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return H(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let t={};return Object.keys(this).forEach(e=>{if(typeof this[e]=="function"||this._privateKeys.includes(e))return;let n=this[e];if(e in this._keyMap){let i=Array.isArray(n)?[]:{};for(let s in n)typeof n[s].toJSON=="function"?i[s]=n[s].toJSON():i[s]=n[s];n=i}t[e]=n}),t}}const S=["http","https"];function $(r,t,e=!0){return q(r,t,!1,e)}function q(r,t=null,e=!1,n=!0){let i=A(r);if(t&&i.is("relative")){let s=A(t),u=s.path();!u.endsWith("/")&&!u.endsWith(".json")&&s.path(u+"/"),i=i.absoluteTo(s)}return i.normalize(),e&&(i.query(""),i.fragment("")),n?i.toString():i}const Z="application/geo+json",Q=["application/json",Z,"text/json"],R=["image/gif","image/jpeg","image/apng","image/png","image/webp"],N=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],D=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(N);function L(r,t,e=!1){return Array.isArray(t)||(t=[t]),e&&typeof r>"u"?!0:typeof r!="string"?!1:(t=t.map(n=>n.toLowerCase()),t.includes(r.toLowerCase()))}function X(r,t=!1){return L(r,Q,t)}class P extends x{constructor(t,e=null,n={},i=[]){super(t,n,["_context"].concat(i)),this._context||(this._context=e)}getAbsoluteUrl(t=!0){return this._context?$(this.href,this._context.getAbsoluteUrl(),t):this.href.includes("://")?t?this.href:A(this.href):null}getContext(){return this._context}canBrowserDisplayImage(t=!1){if(typeof this.href!="string")return!1;if(!t&&typeof this.type>"u")return!1;let e=this.getAbsoluteUrl(!1);e||(e=A(this.href));const n=e.protocol().toLowerCase(),i=e.suffix().toLowerCase();return f(n)&&!S.includes(n)?!1:f(this.type)&&R.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&f(i)&&(i==="jpg"||R.includes("image/"+i)))}isType(t){return f(this.type)&&L(this.type,t)}isGeoTIFF(){return this.isType(D)}isCOG(){return this.isType(N)}isHTTP(){let t=this.getAbsoluteUrl(!1);if(!t)return null;const e=t.protocol().toLowerCase();return f(e)&&S.includes(e)}isPreview(){return!1}}class O extends P{constructor(t,e=null){super(t,e)}isLink(){return!0}getObjectType(){return"Link"}isPreview(){return this.rel==="preview"}static fromLinks(t,e=null){return Array.isArray(t)?t.map(n=>c(n)?new O(n,e):n):[]}}class j extends x{constructor(t,e=null,n={},i=[]){if(super(t,Object.assign({links:O.fromLinks},n),["_url"].concat(i)),!this._url&&(this._url=e,!this._url)){let s=this.getSelfLink();s&&(this._url=s.href)}}getAbsoluteUrl(t=!0){return t?this._url:A(this._url)}setAbsoluteUrl(t){this._url=t}getStacLinksWithRel(t,e=!0){return this.getLinksWithRels([t]).filter(n=>X(n.type,e))}getStacLinkWithRel(t,e=!0){const n=this.getStacLinksWithRel(t,e);return n.length>0?n[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(t=>c(t)&&f(t.href)):[]}getLinkWithRel(t){return this.getLinks().find(e=>e.rel===t)||null}getLinksWithRels(t){return this.getLinks().filter(e=>t.includes(e.rel))}getLinksWithOtherRels(t){return this.getLinks().filter(e=>!t.includes(e.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class F extends j{constructor(t,e=null,n={},i=[]){super(t,e,n,i)}getAll(){return[]}}class m extends x{constructor(t,e=null,n=null){super(t,{},["_index","_context"]),typeof this._index!="number"&&(this._index=typeof e=="string"?parseInt(e,10):e),this._context||(this._context=n)}getContext(){return this._context}getObjectType(){return"Band"}isBand(){return!0}getIndex(){return this._index}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context)return this._context.getMetadata(t)}getMinMaxValues(){return v(this)}getNoDataValues(){return I(this)}static fromBands(t,e=null){let n=[];if(Array.isArray(t))for(let i in t){const s=t[i],u=s instanceof m?s:new m(s,i,e);n.push(u)}return n}}const Y=["created","updated","published","expires","unpublished","bands"];class g extends P{constructor(t,e=null,n=null){const i={bands:m.fromBands,alternate:g.fromAssets};super(t,n,i,["_key"]),this._key||(this._key=e)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(t=!0){return this.isDefinition()?null:super.getAbsoluteUrl(t)}getKey(){return this._key}getMetadata(t){if(typeof this[t]<"u")return this[t];if(this._context instanceof g)return this._context.getMetadata(t);if(this._context&&!Y.includes(t))return this._context.getMetadata(t)}getBands(){return this.bands||[]}findVisualBands(){const t={red:null,green:null,blue:null},e=this.getBands();for(const i in e){const s=parseInt(i,10),u=e[s];c(u)&&f(u["eo:common_name"])&&u["eo:common_name"]in t&&(t[u["eo:common_name"]]=u)}return Object.values(t).every(i=>i!==null)?t:null}findBand(t,e="name"){Array.isArray(t)||(t=[t]);const n=this.getBands(),i=n.findIndex(s=>c(s)&&t.includes(s[e]));return i>=0?n[i]:null}getBand(t){return c(t)||t===null?t:this.getBands()[t]||null}getMinMaxValues(){return v(this)}getNoDataValues(){return I(this)}isDefinition(){return!f(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}isPreview(){const t=["thumbnail","overview"];return t.includes(this.getKey())?!0:Array.isArray(this.roles)&&this.roles.some(e=>t.includes(e))}hasRole(t,e=!1){return Array.isArray(t)||(t=[t]),e&&t.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(n=>t.includes(n))}static fromAssets(t,e=null){let n={};if(c(t))for(let i in t){const s=t[i],u=s instanceof g?s:new g(s,i,e);n[i]=u}return n}}function U(r){if(!r)return;const t=String(r),e=t.indexOf("@"),n=e!==-1?t.substr(e+1):void 0,i=e!==-1?t.substr(0,e):t,s=String(i).replace(/-/g,"_").split("_");if(!s.length||s.length>4)return;const u=s.shift();if(!u)return;const o={keyword:n,language:u.toLowerCase()};if(!s.length)return o;if(s.length===3){const d=s.pop();d&&(o.variant=d.toUpperCase())}let l=s.pop();if(l.length>3&&(o.keyword=l,l=s.pop()),l&&(o.country=l.toUpperCase()),!s.length)return o;const a=s.pop();return typeof a=="string"&&a.length>=1&&(o.script=a[0].toUpperCase()+a.substring(1).toLowerCase()),o}function tt(r){const t={};return r.forEach(e=>{const{language:n,country:i}=U(e);if(!n)throw new Error(`Locale ${e} is not parsable`);t[n]||(t[n]={countries:{},firstCountry:void 0,main:void 0});const s=t[n];i?(s.countries[i]=e,s.firstCountry||(s.firstCountry=e)):s.main=e}),t}function C(r,t,e,n){const i=Array.isArray(r)?tt(r):r;if(!t&&e)return C(r,e,void 0);if(!t)return;const{language:s,country:u}=U(t);if(!s)return e;if(!i[s])return t===e?void 0:C(r,e,null);const{countries:o,main:l=e,firstCountry:a}=i[s];return!o||!u?l:o[u]?o[u]:l}class w extends j{constructor(t,e=null,n={},i=[]){super(t,e,n,i)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getLocaleLink(t,e=null){let n=this.getStacLinksWithRel("alternate").filter(u=>f(u.hreflang)),i;Array.isArray(this.languages)?i=this.languages.map(u=>u.code):i=n.map(u=>u.hreflang);let s=C(i,t,e);return n.find(u=>u.hreflang===s)||null}getIcons(t=!0){return this.getLinksWithRels(["icon"]).filter(e=>e.canBrowserDisplayImage(t))}getThumbnails(t=!0,e=null){let n=this.getAssets().filter(i=>i.isPreview());if(n.length===0&&(n=this.getLinks().filter(i=>i.isPreview())),n.length===0){const i=this.getAsset("thumbnail");i&&n.push(i)}if(t&&(n=n.filter(i=>i.canBrowserDisplayImage())),e&&n.length>1){let i=s=>Array.isArray(s.roles)&&s.roles.includes(e)||s.getKey()===e;n=n.filter(i).concat(n.filter(s=>!i(s)))}return n}getDefaultGeoTIFF(t=!0,e=!1){return this.rankGeoTIFFs(t,e)[0]?.asset}rankGeoTIFFs(t=!0,e=!1,n=null,i=null){c(n)||(n={data:1,visual:2,thumbnail:2,overview:3});let s=[],u=this.getAssetsByTypes(D);t&&(u=u.filter(l=>l.isHTTP()&&(!e||l.isCOG())));let o=Object.entries(n);for(let l of u){let a=0;if(o.length>0){let d=o.filter(([T])=>l.hasRole(T,!0)).map(([,T])=>T);d.length>0&&(a+=Math.max(...d))}!e&&l.isCOG()&&(a+=2),l.findVisualBands()&&(a+=1),typeof i=="function"&&(a+=i(l)),s.push({asset:l,score:a})}return s.sort((l,a)=>a.score-l.score),s}findVisualAssets(){let t={red:null,green:null,blue:null},e=Object.keys(t),n=this.getAssets();for(let s of n){let u=s.findBand(e,"eo:common_name");u&&(t[u["eo:common_name"]]=s)}return Object.values(t).every(s=>s!==null)?t:null}getAsset(t){return c(this.assets)&&this.assets[t]||null}getAssets(){return c(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(t,e=!1){return this.getAssets().filter(n=>n.hasRole(t,e))}getAssetWithRole(t,e=!1){return this.getAssetsWithRoles([t],e)[0]||null}getAssetsByTypes(t){return this.getAssets().filter(e=>L(e.type,t))}equals(t){return this===t?!0:!(t instanceof w)||this.getObjectType()!==t.getObjectType()?!1:!!(this.id&&this.id===t.id)}supportsExtension(t){if(!Array.isArray(this.stac_extensions))return!1;let e=new RegExp("^"+t.replaceAll("*","[^/]+")+"$");return this.stac_extensions.some(n=>e.test(n))}}class G extends w{constructor(t,e=null,n={},i=[]){super(t,e,n,i)}getObjectType(){return this.type}getSearchLink(t=null){let e=this.getStacLinksWithRel("search");return t?e[0]||null:e.find(n=>n.method===t||!t&&!n.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class et extends G{constructor(t,e=null){super(t,e)}}function y(r){if(f(r)&&r.length>=10)try{let e=r.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(n=>parseInt(n,10));return new Date(Date.UTC(e[0],e[1]-1,e[2],e[3],e[4],e[5],e[6]||0))}catch{return null}return null}function nt(r,t){return new Date(r.valueOf()+(t-r)/2)}function J(r){if(!Array.isArray(r)||r.length===0)return null;let t,e;const n=(i,s,u)=>typeof i>"u"?s:i===null||s===null?null:u(i,s);return r.forEach(([i,s])=>{t=n(t,i,Math.min),e=n(e,s,Math.max)}),[t===null?null:new Date(t),e===null?null:new Date(e)]}class M extends G{constructor(t,e=null){const n={assets:g.fromAssets,item_assets:g.fromAssets};super(t,e,n)}toGeoJSON(){let t=z(this.getBoundingBoxes());return t&&(t.id=this.id),t}getBoundingBox(){let t=this.getRawBoundingBoxes();return t.length>0?h(t[0]):null}getBoundingBoxes(){let t=this.getRawBoundingBoxes();return t.length===1?[h(t[0])]:t.length>1?t.slice(1).map(h):null}getRawBoundingBoxes(){let t=this.extent?.spatial?.bbox;return Array.isArray(t)&&t.length>0?t:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=this.extent?.temporal?.interval;return Array.isArray(t)&&t.length>0?t.filter(e=>Array.isArray(e)&&(f(e[0])||f(e[1]))).map(e=>e.map(n=>y(n))):[]}getSummary(t){if(c(this.summaries))return this.summaries[t]}getBands(){let t=this.getMetadata("bands");return Array.isArray(t)||(t=this.getSummary("bands")),Array.isArray(t)?m.fromBands(t,this):[]}}class rt extends F{constructor(t,e=null){const n={collections:i=>i.map(s=>s instanceof M?s:new M(s))};super(t,e,n)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(e=>e.toGeoJSON()).filter(e=>e!==null)}}getBoundingBox(){return W(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(t=>t.getBoundingBox())}getTemporalExtent(){return J(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(t=>t.getTemporalExtent())}}class _ extends w{constructor(t,e=null){super(t,e,{assets:g.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return h(this.bbox)}getBoundingBoxes(){const t=this.getBoundingBox();return t?[t]:[]}getDateTime(){let t=y(this.properties.datetime);if(!t){let e=y(this.properties.start_datetime),n=y(this.properties.end_datetime);return e&&n?nt(e,n):e||n}return t}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let t=[];return f(this.properties.start_datetime)||f(this.properties.end_datetime)?t=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:f(this.properties.datetime)&&(t=[[this.properties.datetime,this.properties.datetime]]),t.map(e=>e.map(n=>y(n)))}getMetadata(t){return this.properties[t]}getBands(){const t=this.getMetadata("bands");return Array.isArray(t)?m.fromBands(t,this):[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class it extends F{constructor(t,e=null){const n={features:i=>i.map(s=>s instanceof _?s:new _(s))};super(t,e,n)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return W(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(t=>t.getBoundingBox())}getTemporalExtent(){return J(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(t=>t.getTemporalExtent())}}function at(r,t=!0,e=!1){return t&&(r=b.stac(r,e)),r.type==="Feature"?new _(r):r.type==="FeatureCollection"?new it(r):r.type==="Collection"||!r.type&&typeof r.extent<"u"&&typeof r.license<"u"?new M(r):!r.type&&Array.isArray(r.collections)?new rt(r):new et(r)}export{F as APICollection,g as Asset,et as Catalog,G as CatalogLike,M as Collection,rt as CollectionCollection,_ as Item,it as ItemCollection,O as Link,w as STAC,j as STACHypermedia,x as STACObject,P as STACReference,at as default};
//# sourceMappingURL=index-BeypnKhb.js.map
