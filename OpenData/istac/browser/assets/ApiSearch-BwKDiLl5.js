const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Catalogs-0TdrrKCK.js","assets/index-C1OYoqWz.js","assets/utils-DJTICtwe.js","assets/_commonjsHelpers-CE1G-McA.js","assets/I18N-DlIXJTel.js","assets/index-BchvTk2E.css","assets/BBadge.vue_vue_type_script_setup_true_lang-D9DEOOtU-CngqnOtr.js","assets/ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--bf0uGAvK.js","assets/CardMixin-9swORhRE.js","assets/formatters-DHrlMhMY.js","assets/helper-DO3U350M.js","assets/datatypes-XrFOh23H.js","assets/BCard.vue_vue_type_script_setup_true_lang-9RhyvL8I-Fqdhapa9.js","assets/BCardText.vue_vue_type_script_setup_true_lang-SRGbviaO-DlV4JFi7.js","assets/Loading-FzMMkwuw.js","assets/Loading-BLYcl2tz.css","assets/Catalogs-DUE2iSw8.css","assets/Items-BLdQ-y9R.js","assets/BCollapse.vue_vue_type_script_setup_true_lang-BUisG8-R-SXzUKtxY.js","assets/MapView-CNAdJ2HL.js","assets/GeoJSON-BjuvHxuB.js","assets/BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-B5CKDn4J.js","assets/useStateClass-BGbSLWFN-DW88tcHJ.js","assets/GeoJSON-Bh2emOAl.css","assets/WMTSCapabilities-BdebdmEm.js","assets/Image-B5xfpoSA.js","assets/ImageLayer-CFGU4lG2.js","assets/BaseImage-Cy3c6Xh6.js","assets/Tile-CQtYv496.js","assets/TileLayer-FUSBo9Q4.js","assets/DataTile-p8pT5WAE.js","assets/Tile-Cl2MG9Yq.js","assets/Tile-BiMOO6Bq.js","assets/common-Lu6Sy4Pz.js","assets/TileRange-2Tc-Ry00.js","assets/LRUCache-DSxkNvez.js","assets/tilecoord-DH-KVnzw.js","assets/BaseTile-pmzuMFYU.js","assets/TileProperty-BF4LcWSy.js","assets/VectorTile-DiZikA7y.js","assets/WebGLTile-Dtgq8K0h.js","assets/compileUtil-asaXcMdF.js","assets/mat4-CeypvY8Z.js","assets/ImageStatic-pYycIUSA.js","assets/Image-DE2iL0r2.js","assets/resolution-CU8ppKQ3.js","assets/common-9rOs42pz.js","assets/static-Bmf09N_e.js","assets/TileJSON-Bx6NTiCm.js","assets/net-DT8WW0DO.js","assets/Tile-BJ3rCrpt.js","assets/TileGrid-DOF7G5nr.js","assets/tileurlfunction-CzVmFeQP.js","assets/uri-DoJhILYp.js","assets/TileImage-B9KVlfju.js","assets/UrlTile-mO59KNp-.js","assets/TileEventType-CTN_nmJ7.js","assets/TileWMS-C2W0EHam.js","assets/wms-s5lRxdL9.js","assets/VectorTile-DgVbYdtm.js","assets/WMTS-BmN87lWj.js","assets/XYZ-3zaPq8YM.js","assets/DataTile-DL5bbeYw.js","assets/MVT-CPCWViNy.js","assets/geotiff-BO2IAWSw.js","assets/__vite-browser-external-B1O5LaIO.js","assets/MapView-eDbLtyS8.css"])))=>i.map(i=>d[i]);
import{a4 as V,n as i,B as d,y as m,bk as U,bl as n,p as a,q as s,L as h,b4 as N,K as u,G as o,b7 as G,H as p,I as H,b6 as K,_ as W,b1 as J,d as Q,cm as X,bI as _,cn as Y,co as $,cp as Z,cq as j,bp as P,bw as x,bx as tt,cr as et,cs as it,ct as at,br as st,bs as rt,bt as k,bu as S}from"./index-C1OYoqWz.js";import{i as L,s as A}from"./utils-DJTICtwe.js";import{S as ot}from"./SearchFilter-C1wdVruG.js";import{L as nt}from"./Loading-FzMMkwuw.js";import{a as lt,_ as ct}from"./BTabs.vue_vue_type_script_setup_true_lang-CU4B0ph2-Bti89sme.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BForm.vue_vue_type_script_setup_true_lang-u44ElAm9-Bb6bSj6Z.js";import"./BFormInput.vue_vue_type_script_setup_true_lang-DRDhfD8d--Rb1PgS9.js";import"./useStateClass-BGbSLWFN-DW88tcHJ.js";import"./debounce-BHqBzJ1a-CHZZ73bA.js";import"./BBadge.vue_vue_type_script_setup_true_lang-D9DEOOtU-CngqnOtr.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--bf0uGAvK.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-B5CKDn4J.js";import"./BFormCheckboxGroup.vue_vue_type_script_setup_true_lang-Dx_mpGFE-D52XhUmS.js";import"./BFormGroup.vue_vue_type_script_setup_true_lang-RIWLdYTY-DvtMcFs0.js";import"./BCard.vue_vue_type_script_setup_true_lang-9RhyvL8I-Fqdhapa9.js";import"./BDropdownText.vue_vue_type_script_setup_true_lang-Cm6QYE9x-Ajgo5TND.js";import"./startOfWeek-m7vVpAR3.js";import"./en-US-DRXoBfJp.js";import"./match-DN4VZKeM.js";import"./buildMatchPatternFn-_eSDZv-o.js";import"./helper-CaHhXSPV.js";import"./helper-DO3U350M.js";const ht={viewBox:"0 0 16 16",width:"1.2em",height:"1.2em"};function ut(t,e){return i(),d("svg",ht,[...e[0]||(e[0]=[m("path",{fill:"currentColor",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"},null,-1)])])}const pt=V({name:"bi-square",render:ut}),dt={viewBox:"0 0 16 16",width:"1.2em",height:"1.2em"};function mt(t,e){return i(),d("svg",dt,[...e[0]||(e[0]=[m("g",{fill:"currentColor"},[m("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"}),m("path",{d:"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093l3.473-4.425z"})],-1)])])}const ft=V({name:"bi-check-square",render:mt}),gt=Q({name:"ApiSearch",components:{Catalogs:k(()=>S(()=>import("./Catalogs-0TdrrKCK.js").then(t=>t.b),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]))),BTabs:ct,BTab:lt,ErrorAlert:X,Loading:nt,SearchFilter:ot,Items:k(()=>S(()=>import("./Items-BLdQ-y9R.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,18,8,9,10,11,12,13,14,15]))),MapView:k(()=>S(()=>import("./MapView-CNAdJ2HL.js"),__vite__mapDeps([19,1,2,3,4,5,20,21,22,7,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66]))),StacLink:k(()=>S(()=>import("./index-C1OYoqWz.js").then(t=>t.d2),__vite__mapDeps([1,2,3,4,5])))},props:{loadParent:{type:String,default:null}},data(){return{parent:null,error:null,errorId:null,link:null,loading:!1,data:null,itemFilters:{},collectionFilters:{},activeSearch:void 0,selectedCollections:{}}},computed:{...rt(["catalogUrl","catalogTitle","searchResultsPerPage","itemsPerPage","collectionsPerPage"]),...st(["canSearchItems","canSearchCollections","getStac","root","collectionLink","parentLink","fromBrowserPath","toBrowserPath"]),selectedCollectionCount(){return A(this.selectedCollections)},totalCount(){return typeof this.data.numberMatched=="number"?this.data.numberMatched:null},supportsSearch(){return this.canSearchCollections||this.canSearchItems},searchLink(){return this.isCollectionSearch?this.collectionSearch:this.itemSearch},collectionSearch(){return this.canSearchCollections&&this.parent&&this.parent.getApiCollectionsLink()},itemSearch(){return this.canSearchItems&&this.parent&&this.parent.getSearchLink()},resultCollection(){return this.isCollectionSearch?new it({collections:this.results,links:[]}):new at({type:"FeatureCollection",features:this.results,links:[]})},results(){if(A(this.data)===0)return[];let t=this.isCollectionSearch?this.data.collections:this.data.features,e=this.isCollectionSearch?"Collection":"Feature";return Array.isArray(t)?t.map(r=>{try{if(!L(r)||r.type!==e)return null;let l=_.getLinkWithRel(r.links,"self"),f;l?.href&&(f=tt(l.href,this.link.href));let g=$(r,f,this.toBrowserPath(f));return g=et(this.$store.state,g),g}catch(l){return console.error(l),null}}).filter(r=>r instanceof P):[]},pagination(){return _.getPaginationLinks(this.data)},filters(){return this.isCollectionSearch?this.collectionFilters:this.itemFilters},isCollectionSearch(){return this.collectionSearch&&this.activeSearch==="search-collections-tab"},pageDescription(){let t=x([this.collectionLink,this.parentLink,this.root],this.catalogTitle);return this.$t("search.metaDescription",{title:t})},noFurtherItems(){return this.link&&this.link.rel==="next"}},watch:{activeSearch(){this.data=null},searchLink:{immediate:!0,handler(){this.searchLink&&this.showPage()}}},async created(){let t=this.catalogUrl;this.loadParent?(t=this.fromBrowserPath(this.loadParent),this.parent=this.getStac(t)):this.parent=this.root,this.parent||(await this.$store.dispatch("load",{url:t}),this.root||await this.$store.dispatch("config",{catalogUrl:t}),this.parent=this.getStac(t),this.showPage())},methods:{openItemSearch(){this.itemFilters.collections=Object.keys(this.selectedCollections),this.activeSearch="search-items-tab",this.selectedCollections={}},selectForItemSearch(t){this.selectedCollections[t.id]?delete this.selectedCollections[t.id]:this.selectedCollections[t.id]=!0},canFilterItems(t){return t instanceof P?!!t.getApiItemsLink():!1},async loadResults(t){this.error=null,this.errorId=null,this.loading=!0;try{this.link=_.addFiltersToLink(t,this.filters,this.searchResultsPerPage);const e=this.isCollectionSearch?"collections":"features",r=await Y(this.$store,this.link);if(r&&this.showPage(r.config.url),!L(r.data)||!Array.isArray(r.data[e]))this.data={},this.error=this.$t(this.isCollectionSearch?"errors.invalidStacCollections":"errors.invalidStacItems");else{const l=this.link.getAbsoluteUrl();this.data=$(r.data,l,this.toBrowserPath(l))}}catch(e){this.data={},this.error=Z(e),this.errorId=j(e)}finally{this.loading=!1}},async setFilters(t,e=!1){this.isCollectionSearch?this.collectionFilters=t:this.itemFilters=t,e?this.data=null:await this.loadResults(this.searchLink)},showPage(t){this.$store.commit("showPage",{url:t,page:()=>({title:this.$t("search.title"),description:this.pageDescription})})}}}),Ct={class:"search d-flex flex-column"},kt={key:0,id:"search-map"},St={class:"ms-2"};function _t(t,e,r,l,f,g){const b=n("Loading"),y=n("ErrorAlert"),F=n("SearchFilter"),v=n("b-tab"),B=n("b-tabs"),I=N,C=G,E=n("MapView"),T=ft,R=pt,w=W,M=n("StacLink"),D=K,O=n("Catalogs"),z=n("Items"),q=J;return i(),d("main",Ct,[t.parent?t.supportsSearch?(i(),a(q,{key:2},{default:s(()=>[h(I,{class:"left"},{default:s(()=>[h(B,{modelValue:t.activeSearch,"onUpdate:modelValue":e[0]||(e[0]=c=>t.activeSearch=c)},{default:s(()=>[t.collectionSearch?(i(),a(v,{key:0,title:t.$t("search.tabs.collections"),id:"search-collections-tab"},{default:s(()=>[h(F,{parent:t.parent,title:"",value:t.collectionFilters,type:"Collections",onInput:t.setFilters},null,8,["parent","value","onInput"])]),_:1},8,["title"])):u("",!0),e[1]||(e[1]=o()),t.itemSearch?(i(),a(v,{key:1,title:t.$t("search.tabs.items"),id:"search-items-tab"},{default:s(()=>[h(F,{parent:t.parent,title:"",value:t.itemFilters,type:"Global",onInput:t.setFilters},null,8,["parent","value","onInput"])]),_:1},8,["title"])):u("",!0)]),_:1},8,["modelValue"])]),_:1}),e[5]||(e[5]=o()),h(I,{class:"right"},{default:s(()=>[t.loading?(i(),a(b,{key:0,fill:"",top:""})):t.error?(i(),a(y,{key:1,description:t.error,id:t.errorId},null,8,["description","id"])):t.data===null?(i(),a(C,{key:2,variant:"info",show:""},{default:s(()=>[o(p(t.$t("search.modifyCriteria")),1)]),_:1})):t.results.length===0&&t.noFurtherItems?(i(),a(C,{key:3,variant:"info",show:""},{default:s(()=>[o(p(t.$t("search.noFurtherItemsFound")),1)]),_:1})):t.results.length===0?(i(),a(C,{key:4,variant:"warning",show:""},{default:s(()=>[o(p(t.$t("search.noItemsFound")),1)]),_:1})):(i(),d(H,{key:5},[t.resultCollection?(i(),d("div",kt,[h(E,{stac:t.parent,children:t.resultCollection,onfocusOnly:"",popover:""},null,8,["stac","children"])])):u("",!0),e[4]||(e[4]=o()),t.isCollectionSearch?(i(),a(O,{key:1,catalogs:t.results,collectionsOnly:"",pagination:t.pagination,loading:t.loading,onPaginate:t.loadResults,count:t.totalCount,apiFilters:t.collectionFilters},{catalogFooter:s(c=>[t.itemSearch||t.canFilterItems(c.data)?(i(),a(D,{key:0,vertical:"",size:"sm"},{default:s(()=>[t.itemSearch?(i(),a(w,{key:0,variant:"outline-primary",pressed:t.selectedCollections[c.data.id],onClick:bt=>t.selectForItemSearch(c.data)},{default:s(()=>[t.selectedCollections[c.data.id]?(i(),a(T,{key:0})):(i(),a(R,{key:1})),e[2]||(e[2]=o()),m("span",St,p(t.$t("search.selectForItemSearch")),1)]),_:2},1032,["pressed","onClick"])):u("",!0),e[3]||(e[3]=o()),h(M,{button:{variant:"outline-primary",disabled:!t.canFilterItems(c.data)},data:c.data,title:t.$t("search.filterCollection"),state:{itemFilterOpen:1}},null,8,["button","data","title"])]),_:2},1024)):u("",!0)]),_:1},8,["catalogs","pagination","loading","onPaginate","count","apiFilters"])):(i(),a(z,{key:2,stac:t.parent,items:t.results,api:!0,allowFilter:!1,pagination:t.pagination,loading:t.loading,onPaginate:t.loadResults,count:t.totalCount,apiFilters:t.itemFilters},null,8,["stac","items","pagination","loading","onPaginate","count","apiFilters"]))],64))]),_:1})]),_:1})):(i(),a(y,{key:1,description:t.$t("search.notSupported")},null,8,["description"])):(i(),a(b,{key:0,stretch:""})),e[6]||(e[6]=o()),t.selectedCollectionCount>0?(i(),a(C,{key:3,show:"",variant:"dark",class:"selected-collections-action"},{default:s(()=>[h(w,{onClick:t.openItemSearch,variant:"primary",size:"lg"},{default:s(()=>[o(p(t.$t("search.useInItemSearch",t.selectedCollectionCount,{count:t.selectedCollectionCount})),1)]),_:1},8,["onClick"])]),_:1})):u("",!0)])}const Wt=U(gt,[["render",_t]]);export{Wt as default};
//# sourceMappingURL=ApiSearch-BwKDiLl5.js.map
