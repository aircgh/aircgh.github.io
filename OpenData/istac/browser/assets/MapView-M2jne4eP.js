const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/GeoJSON-CeOkJNhj.js","assets/index-EEKoSAfw.js","assets/utils-DJTICtwe.js","assets/_commonjsHelpers-CE1G-McA.js","assets/I18N-DlIXJTel.js","assets/index-BchvTk2E.css","assets/BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-eyD5Sj5b.js","assets/useStateClass-BGbSLWFN-00uHobAK.js","assets/ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--BICBjaaT.js","assets/GeoJSON-Bh2emOAl.css","assets/bootstrap-vue-next-C6nJgSTY.js","assets/BOffcanvas.vue_vue_type_script_setup_true_lang-BbXmU_5z-D-nUwBgm.js","assets/BAccordion.vue_vue_type_script_setup_true_lang-Ccx3zW5a-BUJNSi-0.js","assets/BTabs.vue_vue_type_script_setup_true_lang-CU4B0ph2-CmvwVo5W.js","assets/BCollapse.vue_vue_type_script_setup_true_lang-BUisG8-R-BUjEcP57.js","assets/BBadge.vue_vue_type_script_setup_true_lang-D9DEOOtU-CJj1_YW7.js","assets/BTable.vue_vue_type_script_setup_true_lang-D6ymr5i1-CMbuROEo.js","assets/debounce-BHqBzJ1a-B1oSYXtn.js","assets/BCard.vue_vue_type_script_setup_true_lang-9RhyvL8I-CG3PpgqI.js","assets/BCardText.vue_vue_type_script_setup_true_lang-SRGbviaO-CyyBIvaW.js","assets/BDropdownText.vue_vue_type_script_setup_true_lang-Cm6QYE9x-V6NuLWr4.js","assets/BForm.vue_vue_type_script_setup_true_lang-u44ElAm9-CTcfCZrX.js","assets/BFormSelect.vue_vue_type_script_setup_true_lang-djrVhugk-BlIQr1sE.js","assets/BFormGroup.vue_vue_type_script_setup_true_lang-RIWLdYTY-CQwbUqBl.js","assets/BFormCheckboxGroup.vue_vue_type_script_setup_true_lang-Dx_mpGFE-DE5wwKBV.js","assets/BFormInput.vue_vue_type_script_setup_true_lang-DRDhfD8d-CbrX4KN0.js","assets/BInputGroupText.vue_vue_type_script_setup_true_lang-BBN5F0A4-CLfekJbq.js","assets/BListGroupItem.vue_vue_type_script_setup_true_lang-J0Ydbiva-BrDhjgqu.js","assets/Features-DKxCWDAB.js","assets/helper-CaHhXSPV.js","assets/helper-DO3U350M.js","assets/datatypes-XrFOh23H.js","assets/Catalogs-B03kkeYL.js","assets/CardMixin-CZxdeYDP.js","assets/formatters-Cg3Rg20C.js","assets/Loading-DF-Qn8M_.js","assets/Loading-BLYcl2tz.css","assets/Catalogs-DUE2iSw8.css","assets/Items-0oQmoZAX.js"])))=>i.map(i=>d[i]);
import{cP as Mr,bu as le,bk as Cr,bl as K,n as $,B as Er,y as ye,L as ut,G as ae,p as q,K as ct,q as ht,_ as Ir,H as Fr,cQ as Or,br as Pr,bt as _e}from"./index-EEKoSAfw.js";import{I as Br,s as Rr,n as ft,a as kr,T as dt,C as Dr,g as oe,b as we,V as ze,F as mt,c as Ur,d as Gr,e as gt,B as Bt,f as Oe,E as jr,h as Rt,S as Wr,i as Vr,j as zr,k as Nr,l as pt,m as yt,o as Zr,p as Hr,q as $r,t as Jr,r as Kr,u as qr,v as Xr,w as Yr,x as Qr,y as ei,z as ti,P as ri,A as ii,L as ni,D as si,G as _t,H as kt,J as ai,M as oi,K as li,N as ui,O as ci}from"./GeoJSON-CeOkJNhj.js";import hi from"./WMTSCapabilities-DVaGRzBu.js";import fi from"./Image-BgRT-RxN.js";import wt from"./Tile-DheFLPcT.js";import di from"./VectorTile-BqFU2XQ3.js";import vt from"./WebGLTile-DQ-usLi-.js";import mi from"./ImageStatic-yB0xBZJS.js";import gi from"./TileJSON-CsyG4vWC.js";import pi from"./TileWMS-Cim86C_t.js";import{V as Dt}from"./VectorTile-CcosAgei.js";import yi,{optionsFromCapabilities as _i}from"./WMTS-CGJQEi8C.js";import xt from"./XYZ-gF6v-tMH.js";import Ut from"./DataTile-f1xhAM11.js";import{c as Gt,e as jt}from"./Tile-VALq5jNu.js";import{M as wi}from"./MVT-DixZ1Uju.js";import{b as fe}from"./utils-DJTICtwe.js";import{f as vi,a as xi,b as bi,P as Ti,p as Ai}from"./geotiff-D5lVkYkd.js";import{T as Li}from"./TileGrid-De1n6MP2.js";import"./_commonjsHelpers-CE1G-McA.js";import"./I18N-DlIXJTel.js";import"./BFormRadioGroup.vue_vue_type_script_setup_true_lang-DaMHx4U3-eyD5Sj5b.js";import"./useStateClass-BGbSLWFN-00uHobAK.js";import"./ConditionalWrapper.vue_vue_type_script_lang-IX_NpHH--BICBjaaT.js";import"./ImageLayer-CgehtxLz.js";import"./BaseImage-BJE6NhyS.js";import"./TileLayer-Dc6tq0Gn.js";import"./DataTile-Bmbl2OFx.js";import"./Tile-DIYofsPF.js";import"./Tile-DOycnn12.js";import"./common-BO1mfZuN.js";import"./TileRange-2Tc-Ry00.js";import"./LRUCache-bbU-Dn-U.js";import"./tilecoord-CCvhFDG2.js";import"./BaseTile-ETqRVqhp.js";import"./TileProperty-BF4LcWSy.js";import"./compileUtil-sRJmHDmy.js";import"./mat4-CeypvY8Z.js";import"./Image-B9HrrUhk.js";import"./resolution-CU8ppKQ3.js";import"./common-9rOs42pz.js";import"./static-DEdTgU_n.js";import"./net-DZpGeuGz.js";import"./tileurlfunction-BzDPhbsW.js";import"./uri-Dl9pl3_t.js";import"./TileImage-c3ACdgwy.js";import"./UrlTile-6inhu0_e.js";import"./TileEventType-CTN_nmJ7.js";import"./wms-B6t0u64h.js";import"./__vite-browser-external-B1O5LaIO.js";const ve={SELECT:"select"};class xe extends Bt{constructor(e,t,r,n){super(e),this.selected=t,this.deselected=r,this.mapBrowserEvent=n}}const be={};class Ne extends Br{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:Rr,this.addCondition_=e.addCondition?e.addCondition:ft,this.removeCondition_=e.removeCondition?e.removeCondition:ft,this.toggleCondition_=e.toggleCondition?e.toggleCondition:kr,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:dt,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:Si(),this.features_=e.features||new Dr;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{const r=e.layers;t=function(n){return r.includes(n)}}else t=dt;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[oe(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[oe(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(we.ADD,this.boundAddFeature_),this.features_.addEventListener(we.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(we.ADD,this.boundAddFeature_),this.features_.removeEventListener(we.REMOVE,this.boundRemoveFeature_))}addFeature_(e){const t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){const r=this.findLayerOfFeature_(t);r&&this.addFeatureLayerAssociation_(t,r)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}findLayerOfFeature_(e){return this.getMap().getAllLayers().find(function(r){if(r instanceof ze&&r.getSource()&&r.getSource().hasFeature(e))return r})}getStyle(){return this.style_}applySelectedStyle_(e){const t=oe(e);t in be||(be[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){const t=this.getMap().getInteractions().getArray();for(let n=t.length-1;n>=0;--n){const s=t[n];if(s!==this&&s instanceof Ne&&s.getStyle()&&s.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(s.getStyle());return}}const r=oe(e);e.setStyle(be[r]),delete be[r]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[oe(e)]}selectFeatureInternal_(e,t,r){if(!(e instanceof mt)||!this.filter_(e,t))return;const n=this.getFeatures();return n.getArray().includes(e)||(this.addFeatureLayerAssociation_(e,t),n.push(e),r?.push(e)),e}selectFeature(e){const t=this.findLayerOfFeature_(e);if(!this.layerFilter_(t))return!1;const r=this.selectFeatureInternal_(e,t);return r&&this.dispatchEvent(new xe(ve.SELECT,[r],[],void 0)),!!r}removeFeatureInternal_(e,t){const r=this.getFeatures();if(!(!(e instanceof mt)||!r.getArray().includes(e)))return r.remove(e),this.removeFeatureLayerAssociation_(e),t?.push(e),e}deselectFeature(e){const t=this.removeFeatureInternal_(e);return t&&this.dispatchEvent(new xe(ve.SELECT,[],[t],void 0)),!!t}toggleFeature(e){this.deselectFeature(e)||this.selectFeature(e)}clearSelection(){Ur(this.featureLayerAssociation_);const e=this.getFeatures(),t=e.getArray().slice();e.clear(),t.length!==0&&this.dispatchEvent(new xe(ve.SELECT,[],t,void 0))}handleEvent(e){if(!this.condition_(e))return!0;const t=this.addCondition_(e),r=this.removeCondition_(e),n=this.toggleCondition_(e),s=!t&&!r&&!n,a=e.map,o=this.getFeatures(),l=[],u=[];if(s){let h=!1;a.forEachFeatureAtPixel(e.pixel,(c,f)=>{if(h=!0,!!this.selectFeatureInternal_(c,f,u))return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let c=o.getLength()-1;c>=0;--c){const f=o.item(c);(u.length>0&&!u.includes(f)||!h)&&this.removeFeatureInternal_(f,l)}}else a.forEachFeatureAtPixel(e.pixel,(h,c)=>{let f;if((r||n)&&(f=this.removeFeatureInternal_(h,l)),(t||n)&&!f&&(f=this.selectFeatureInternal_(h,c,u)),!!f)return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});return(u.length>0||l.length>0)&&this.dispatchEvent(new xe(ve.SELECT,u,l,e)),!0}}function Si(){const i=Gr();return gt(i.Polygon,i.LineString),gt(i.GeometryCollection,i.LineString),function(e){return e.getGeometry()?i[e.getGeometry().getType()]:null}}var R=Uint8Array,Q=Uint16Array,Mi=Int32Array,Wt=new R([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Vt=new R([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ci=new R([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zt=function(i,e){for(var t=new Q(31),r=0;r<31;++r)t[r]=e+=1<<i[r-1];for(var n=new Mi(t[30]),r=1;r<30;++r)for(var s=t[r];s<t[r+1];++s)n[s]=s-t[r]<<5|r;return{b:t,r:n}},Nt=zt(Wt,2),Zt=Nt.b,Ei=Nt.r;Zt[28]=258,Ei[258]=28;var Ii=zt(Vt,0),Fi=Ii.b,Ue=new Q(32768);for(var T=0;T<32768;++T){var H=(T&43690)>>1|(T&21845)<<1;H=(H&52428)>>2|(H&13107)<<2,H=(H&61680)>>4|(H&3855)<<4,Ue[T]=((H&65280)>>8|(H&255)<<8)>>1}var he=(function(i,e,t){for(var r=i.length,n=0,s=new Q(e);n<r;++n)i[n]&&++s[i[n]-1];var a=new Q(e);for(n=1;n<e;++n)a[n]=a[n-1]+s[n-1]<<1;var o;if(t){o=new Q(1<<e);var l=15-e;for(n=0;n<r;++n)if(i[n])for(var u=n<<4|i[n],h=e-i[n],c=a[i[n]-1]++<<h,f=c|(1<<h)-1;c<=f;++c)o[Ue[c]>>l]=u}else for(o=new Q(r),n=0;n<r;++n)i[n]&&(o[n]=Ue[a[i[n]-1]++]>>15-i[n]);return o}),me=new R(288);for(var T=0;T<144;++T)me[T]=8;for(var T=144;T<256;++T)me[T]=9;for(var T=256;T<280;++T)me[T]=7;for(var T=280;T<288;++T)me[T]=8;var Ht=new R(32);for(var T=0;T<32;++T)Ht[T]=5;var Oi=he(me,9,1),Pi=he(Ht,5,1),Pe=function(i){for(var e=i[0],t=1;t<i.length;++t)i[t]>e&&(e=i[t]);return e},j=function(i,e,t){var r=e/8|0;return(i[r]|i[r+1]<<8)>>(e&7)&t},Be=function(i,e){var t=e/8|0;return(i[t]|i[t+1]<<8|i[t+2]<<16)>>(e&7)},Bi=function(i){return(i+7)/8|0},Ri=function(i,e,t){return(t==null||t>i.length)&&(t=i.length),new R(i.subarray(e,t))},ki=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],B=function(i,e,t){var r=new Error(e||ki[i]);if(r.code=i,Error.captureStackTrace&&Error.captureStackTrace(r,B),!t)throw r;return r},Ze=function(i,e,t,r){var n=i.length,s=0;if(!n||e.f&&!e.l)return t||new R(0);var a=!t,o=a||e.i!=2,l=e.i;a&&(t=new R(n*3));var u=function(at){var ot=t.length;if(at>ot){var lt=new R(Math.max(ot*2,at));lt.set(t),t=lt}},h=e.f||0,c=e.p||0,f=e.b||0,m=e.l,_=e.d,p=e.m,d=e.n,g=n*8;do{if(!m){h=j(i,c,1);var w=j(i,c+1,3);if(c+=3,w)if(w==1)m=Oi,_=Pi,p=9,d=5;else if(w==2){var W=j(i,c,31)+257,A=j(i,c+10,15)+4,C=W+j(i,c+5,31)+1;c+=14;for(var x=new R(C),S=new R(19),M=0;M<A;++M)S[Ci[M]]=j(i,c+M*3,7);c+=A*3;for(var U=Pe(S),ie=(1<<U)-1,ne=he(S,U,1),M=0;M<C;){var G=ne[j(i,c,ie)];c+=G&15;var y=G>>4;if(y<16)x[M++]=y;else{var N=0,pe=0;for(y==16?(pe=3+j(i,c,3),c+=2,N=x[M-1]):y==17?(pe=3+j(i,c,7),c+=3):y==18&&(pe=11+j(i,c,127),c+=7);pe--;)x[M++]=N}}var rt=x.subarray(0,W),Z=x.subarray(W);p=Pe(rt),d=Pe(Z),m=he(rt,p,1),_=he(Z,d,1)}else B(1);else{var y=Bi(c)+4,O=i[y-4]|i[y-3]<<8,I=y+O;if(I>n){l&&B(0);break}o&&u(f+O),t.set(i.subarray(y,I),f),e.b=f+=O,e.p=c=I*8,e.f=h;continue}if(c>g){l&&B(0);break}}o&&u(f+131072);for(var Ar=(1<<p)-1,Lr=(1<<d)-1,Ee=c;;Ee=c){var N=m[Be(i,c)&Ar],J=N>>4;if(c+=N&15,c>g){l&&B(0);break}if(N||B(2),J<256)t[f++]=J;else if(J==256){Ee=c,m=null;break}else{var it=J-254;if(J>264){var M=J-257,se=Wt[M];it=j(i,c,(1<<se)-1)+Zt[M],c+=se}var Ie=_[Be(i,c)&Lr],Fe=Ie>>4;Ie||B(3),c+=Ie&15;var Z=Fi[Fe];if(Fe>3){var se=Vt[Fe];Z+=Be(i,c)&(1<<se)-1,c+=se}if(c>g){l&&B(0);break}o&&u(f+131072);var nt=f+it;if(f<Z){var st=s-Z,Sr=Math.min(Z,nt);for(st+f<0&&B(3);f<Sr;++f)t[f]=r[st+f]}for(;f<nt;++f)t[f]=t[f-Z]}}e.l=m,e.p=Ee,e.b=f,e.f=h,m&&(h=1,e.m=p,e.d=_,e.n=d)}while(!h);return f!=t.length&&a?Ri(t,0,f):t.subarray(0,f)},Di=new R(0),Ui=function(i){(i[0]!=31||i[1]!=139||i[2]!=8)&&B(6,"invalid gzip data");var e=i[3],t=10;e&4&&(t+=(i[10]|i[11]<<8)+2);for(var r=(e>>3&1)+(e>>4&1);r>0;r-=!i[t++]);return t+(e&2)},Gi=function(i){var e=i.length;return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0},ji=function(i,e){return((i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31)&&B(6,"invalid zlib data"),(i[1]>>5&1)==1&&B(6,"invalid zlib data: "+(i[1]&32?"need":"unexpected")+" dictionary"),(i[1]>>3&4)+2};function Wi(i,e){return Ze(i,{i:2},e,e)}function Vi(i,e){var t=Ui(i);return t+8>i.length&&B(6,"invalid gzip data"),Ze(i.subarray(t,-8),{i:2},new R(Gi(i)),e)}function zi(i,e){return Ze(i.subarray(ji(i),-4),{i:2},e,e)}function Ni(i,e){return i[0]==31&&i[1]==139&&i[2]==8?Vi(i,e):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?Wi(i,e):zi(i,e)}var Zi=typeof TextDecoder<"u"&&new TextDecoder,Hi=0;try{Zi.decode(Di,{stream:!0}),Hi=1}catch{}var $i=Object.defineProperty,Ji=Math.pow,v=(i,e)=>$i(i,"name",{value:e,configurable:!0}),E=(i,e,t)=>new Promise((r,n)=>{var s=l=>{try{o(t.next(l))}catch(u){n(u)}},a=l=>{try{o(t.throw(l))}catch(u){n(u)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,a);o((t=t.apply(i,e)).next())});v((i,e)=>{let t=!1,r="",n=L.GridLayer.extend({createTile:v((s,a)=>{let o=document.createElement("img"),l=new AbortController,u=l.signal;return o.cancel=()=>{l.abort()},t||(i.getHeader().then(h=>{h.tileType===1?console.error("Error: archive contains MVT vector tiles, but leafletRasterLayer is for displaying raster tiles. See https://github.com/protomaps/PMTiles/tree/main/js for details."):h.tileType===2?r="image/png":h.tileType===3?r="image/jpeg":h.tileType===4?r="image/webp":h.tileType===5&&(r="image/avif")}),t=!0),i.getZxy(s.z,s.x,s.y,u).then(h=>{if(h){let c=new Blob([h.data],{type:r}),f=window.URL.createObjectURL(c);o.src=f}else o.style.display="none";o.cancel=void 0,a(void 0,o)}).catch(h=>{if(h.name!=="AbortError")throw h}),o},"createTile"),_removeTile:v(function(s){let a=this._tiles[s];a&&(a.el.cancel&&a.el.cancel(),a.el.width=0,a.el.height=0,a.el.deleted=!0,L.DomUtil.remove(a.el),delete this._tiles[s],this.fire("tileunload",{tile:a.el,coords:this._keyToTileCoords(s)}))},"_removeTile")});return new n(e)},"leafletRasterLayer");var Ki=v(i=>(e,t)=>{if(t instanceof AbortController)return i(e,t);let r=new AbortController;return i(e,r).then(n=>t(void 0,n.data,n.cacheControl||"",n.expires||""),n=>t(n)).catch(n=>t(n)),{cancel:v(()=>r.abort(),"cancel")}},"v3compat"),qi=class{constructor(e){this.tilev4=v((t,r)=>E(this,null,function*(){if(t.type==="json"){let m=t.url.substr(10),_=this.tiles.get(m);if(_||(_=new de(m),this.tiles.set(m,_)),this.metadata){let d=yield _.getTileJson(t.url);return r.signal.throwIfAborted(),{data:d}}let p=yield _.getHeader();return r.signal.throwIfAborted(),(p.minLon>=p.maxLon||p.minLat>=p.maxLat)&&console.error(`Bounds of PMTiles archive ${p.minLon},${p.minLat},${p.maxLon},${p.maxLat} are not valid.`),{data:{tiles:[`${t.url}/{z}/{x}/{y}`],minzoom:p.minZoom,maxzoom:p.maxZoom,bounds:[p.minLon,p.minLat,p.maxLon,p.maxLat]}}}let n=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=t.url.match(n);if(!s)throw new Error("Invalid PMTiles protocol URL");let a=s[1],o=this.tiles.get(a);o||(o=new de(a),this.tiles.set(a,o));let l=s[2],u=s[3],h=s[4],c=yield o.getHeader(),f=yield o?.getZxy(+l,+u,+h,r.signal);if(r.signal.throwIfAborted(),f)return{data:new Uint8Array(f.data),cacheControl:f.cacheControl,expires:f.expires};if(c.tileType===1){if(this.errorOnMissingTile)throw new Error("Tile not found.");return{data:new Uint8Array}}return{data:null}}),"tilev4"),this.tile=Ki(this.tilev4),this.tiles=new Map,this.metadata=e?.metadata||!1,this.errorOnMissingTile=e?.errorOnMissingTile||!1}add(e){this.tiles.set(e.source.getKey(),e)}get(e){return this.tiles.get(e)}};v(qi,"Protocol");function $t(i,e){return(e>>>0)*4294967296+(i>>>0)}v($t,"toNum");function Jt(i,e){let t=e.buf,r=t[e.pos++],n=(r&112)>>4;if(r<128||(r=t[e.pos++],n|=(r&127)<<3,r<128)||(r=t[e.pos++],n|=(r&127)<<10,r<128)||(r=t[e.pos++],n|=(r&127)<<17,r<128)||(r=t[e.pos++],n|=(r&127)<<24,r<128)||(r=t[e.pos++],n|=(r&1)<<31,r<128))return $t(i,n);throw new Error("Expected varint not more than 10 bytes")}v(Jt,"readVarintRemainder");function X(i){let e=i.buf,t=e[i.pos++],r=t&127;return t<128||(t=e[i.pos++],r|=(t&127)<<7,t<128)||(t=e[i.pos++],r|=(t&127)<<14,t<128)||(t=e[i.pos++],r|=(t&127)<<21,t<128)?r:(t=e[i.pos],r|=(t&15)<<28,Jt(r,i))}v(X,"readVarint");function He(i,e,t,r,n){return n===0?r!==0?[i-1-t,i-1-e]:[t,e]:[e,t]}v(He,"rotate");function Kt(i,e,t){if(i>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");if(e>=1<<i||t>=1<<i)throw new Error("tile x/y outside zoom level bounds");let r=((1<<i)*(1<<i)-1)/3,n=i-1,[s,a]=[e,t];for(let o=1<<n;o>0;o>>=1){let l=s&o,u=a&o;r+=(3*l^u)*(1<<n),[s,a]=He(o,s,a,l,u),n--}return r}v(Kt,"zxyToTileId");function qt(i){let e=3*i+1;return e<4294967296?31-Math.clz32(e):63-Math.clz32(e/4294967296)}v(qt,"tileIdToZ");function Xi(i){let e=qt(i)>>1;if(e>26)throw new Error("Tile zoom level exceeds max safe number limit (26)");let t=((1<<e)*(1<<e)-1)/3,r=i-t,n=0,s=0,a=1<<e;for(let o=1;o<a;o<<=1){let l=o&r/2,u=o&(r^l);[n,s]=He(o,n,s,l,u),r=r/2,n+=l,s+=u}return[e,n,s]}v(Xi,"tileIdToZxy");var Yi=(i=>(i[i.Unknown=0]="Unknown",i[i.None=1]="None",i[i.Gzip=2]="Gzip",i[i.Brotli=3]="Brotli",i[i.Zstd=4]="Zstd",i))(Yi||{});function Me(i,e){return E(this,null,function*(){if(e===1||e===0)return i;if(e===2){if(typeof globalThis.DecompressionStream>"u")return Ni(new Uint8Array(i));let t=new Response(i).body;if(!t)throw new Error("Failed to read response stream");let r=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(r).arrayBuffer()}throw new Error("Compression method not supported")})}v(Me,"defaultDecompress");var Y=(i=>(i[i.Unknown=0]="Unknown",i[i.Mvt=1]="Mvt",i[i.Png=2]="Png",i[i.Jpeg=3]="Jpeg",i[i.Webp=4]="Webp",i[i.Avif=5]="Avif",i[i.Mlt=6]="Mlt",i))(Y||{});function Xt(i){return i===1?".mvt":i===2?".png":i===3?".jpg":i===4?".webp":i===5?".avif":i===6?".mlt":""}v(Xt,"tileTypeExt");var Qi=127;function Yt(i,e){let t=0,r=i.length-1;for(;t<=r;){let n=r+t>>1,s=e-i[n].tileId;if(s>0)t=n+1;else if(s<0)r=n-1;else return i[n]}return r>=0&&(i[r].runLength===0||e-i[r].tileId<i[r].runLength)?i[r]:null}v(Yt,"findTile");var en=class{constructor(e){this.file=e}getKey(){return this.file.name}getBytes(e,t){return E(this,null,function*(){return{data:yield this.file.slice(e,e+t).arrayBuffer()}})}};v(en,"FileSource");var Qt=class{constructor(e,t=new Headers){var r,n;this.url=e,this.customHeaders=t,this.mustReload=!1;let s="";"navigator"in globalThis&&(s=(n=(r=globalThis.navigator)==null?void 0:r.userAgent)!=null?n:"");let a=s.indexOf("Windows")>-1,o=/Chrome|Chromium|Edg|OPR|Brave/.test(s);this.chromeWindowsNoCache=!1,a&&o&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,r,n){return E(this,null,function*(){let s,a;r?a=r:(s=new AbortController,a=s.signal);let o=new Headers(this.customHeaders);o.set("range",`bytes=${e}-${e+t-1}`);let l;this.mustReload?l="reload":this.chromeWindowsNoCache&&(l="no-store");let u=yield fetch(this.url,{signal:a,cache:l,headers:o});if(e===0&&u.status===416){let f=u.headers.get("Content-Range");if(!f||!f.startsWith("bytes */"))throw new Error("Missing content-length on 416 response");let m=+f.substr(8);u=yield fetch(this.url,{signal:a,cache:"reload",headers:{range:`bytes=0-${m-1}`}})}let h=u.headers.get("Etag");if(h!=null&&h.startsWith("W/")&&(h=null),u.status===416||n&&h&&h!==n)throw this.mustReload=!0,new Ge(`Server returned non-matching ETag ${n} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(u.status>=300)throw new Error(`Bad response code: ${u.status}`);let c=u.headers.get("Content-Length");if(u.status===200&&(!c||+c>t))throw s&&s.abort(),new Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield u.arrayBuffer(),etag:h||void 0,cacheControl:u.headers.get("Cache-Control")||void 0,expires:u.headers.get("Expires")||void 0}})}};v(Qt,"FetchSource");var tn=Qt;function k(i,e){let t=i.getUint32(e+4,!0),r=i.getUint32(e+0,!0);return t*Ji(2,32)+r}v(k,"getUint64");function er(i,e){let t=new DataView(i),r=t.getUint8(7);if(r>3)throw new Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:k(t,8),rootDirectoryLength:k(t,16),jsonMetadataOffset:k(t,24),jsonMetadataLength:k(t,32),leafDirectoryOffset:k(t,40),leafDirectoryLength:k(t,48),tileDataOffset:k(t,56),tileDataLength:k(t,64),numAddressedTiles:k(t,72),numTileEntries:k(t,80),numTileContents:k(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}v(er,"bytesToHeader");function $e(i){let e={buf:new Uint8Array(i),pos:0},t=X(e),r=[],n=0;for(let s=0;s<t;s++){let a=X(e);r.push({tileId:n+a,offset:0,length:0,runLength:1}),n+=a}for(let s=0;s<t;s++)r[s].runLength=X(e);for(let s=0;s<t;s++)r[s].length=X(e);for(let s=0;s<t;s++){let a=X(e);a===0&&s>0?r[s].offset=r[s-1].offset+r[s-1].length:r[s].offset=a-1}return r}v($e,"deserializeIndex");var tr=class extends Error{};v(tr,"EtagMismatch");var Ge=tr;function Je(i,e){return E(this,null,function*(){let t=yield i.getBytes(0,16384);if(new DataView(t.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");let r=t.data.slice(0,Qi),n=er(r,t.etag),s=t.data.slice(n.rootDirectoryOffset,n.rootDirectoryOffset+n.rootDirectoryLength),a=`${i.getKey()}|${n.etag||""}|${n.rootDirectoryOffset}|${n.rootDirectoryLength}`,o=$e(yield e(s,n.internalCompression));return[n,[a,o.length,o]]})}v(Je,"getHeaderAndRoot");function Ke(i,e,t,r,n){return E(this,null,function*(){let s=yield i.getBytes(t,r,void 0,n.etag),a=yield e(s.data,n.internalCompression),o=$e(a);if(o.length===0)throw new Error("Empty directory is invalid");return o})}v(Ke,"getDirectory");var rn=class{constructor(e=100,t=!0,r=Me){this.cache=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return E(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,r.data;let n=yield Je(e,this.decompress);return n[1]&&this.cache.set(n[1][0],{lastUsed:this.counter++,data:n[1][2]}),this.cache.set(t,{lastUsed:this.counter++,data:n[0]}),this.prune(),n[0]})}getDirectory(e,t,r,n){return E(this,null,function*(){let s=`${e.getKey()}|${n.etag||""}|${t}|${r}`,a=this.cache.get(s);if(a)return a.lastUsed=this.counter++,a.data;let o=yield Ke(e,this.decompress,t,r,n);return this.cache.set(s,{lastUsed:this.counter++,data:o}),this.prune(),o})}prune(){if(this.cache.size>this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,n)=>{r.lastUsed<e&&(e=r.lastUsed,t=n)}),t&&this.cache.delete(t)}}invalidate(e){return E(this,null,function*(){this.cache.delete(e.getKey())})}};v(rn,"ResolvedValueCache");var rr=class{constructor(e=100,t=!0,r=Me){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=r}getHeader(e){return E(this,null,function*(){let t=e.getKey(),r=this.cache.get(t);if(r)return r.lastUsed=this.counter++,yield r.data;let n=new Promise((s,a)=>{Je(e,this.decompress).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),s(o[0]),this.prune()}).catch(o=>{a(o)})});return this.cache.set(t,{lastUsed:this.counter++,data:n}),n})}getDirectory(e,t,r,n){return E(this,null,function*(){let s=`${e.getKey()}|${n.etag||""}|${t}|${r}`,a=this.cache.get(s);if(a)return a.lastUsed=this.counter++,yield a.data;let o=new Promise((l,u)=>{Ke(e,this.decompress,t,r,n).then(h=>{l(h),this.prune()}).catch(h=>{u(h)})});return this.cache.set(s,{lastUsed:this.counter++,data:o}),o})}prune(){if(this.cache.size>=this.maxCacheEntries){let e=1/0,t;this.cache.forEach((r,n)=>{r.lastUsed<e&&(e=r.lastUsed,t=n)}),t&&this.cache.delete(t)}}invalidate(e){return E(this,null,function*(){let t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());let r=new Promise((n,s)=>{this.getHeader(e).then(a=>{n(),this.invalidations.delete(t)}).catch(a=>{s(a)})});this.invalidations.set(t,r)})}};v(rr,"SharedPromiseCache");var nn=rr,ir=class{constructor(e,t,r){typeof e=="string"?this.source=new tn(e):this.source=e,r?this.decompress=r:this.decompress=Me,t?this.cache=t:this.cache=new nn}getHeader(){return E(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(e,t,r,n){return E(this,null,function*(){let s=Kt(e,t,r),a=yield this.cache.getHeader(this.source);if(e<a.minZoom||e>a.maxZoom)return;let o=a.rootDirectoryOffset,l=a.rootDirectoryLength;for(let u=0;u<=3;u++){let h=yield this.cache.getDirectory(this.source,o,l,a),c=Yt(h,s);if(c){if(c.runLength>0){let f=yield this.source.getBytes(a.tileDataOffset+c.offset,c.length,n,a.etag);return{data:yield this.decompress(f.data,a.tileCompression),cacheControl:f.cacheControl,expires:f.expires}}o=a.leafDirectoryOffset+c.offset,l=c.length}else return}throw new Error("Maximum directory depth exceeded")})}getZxy(e,t,r,n){return E(this,null,function*(){try{return yield this.getZxyAttempt(e,t,r,n)}catch(s){if(s instanceof Ge)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,r,n);throw s}})}getMetadataAttempt(){return E(this,null,function*(){let e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),r=yield this.decompress(t.data,e.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(r))})}getMetadata(){return E(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof Ge)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}})}getTileJson(e){return E(this,null,function*(){let t=yield this.getHeader(),r=yield this.getMetadata(),n=Xt(t.tileType);return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${n}`],vector_layers:r.vector_layers,attribution:r.attribution,description:r.description,name:r.name,version:r.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}})}};v(ir,"PMTiles");var de=ir,nr=Object.defineProperty,bt=Object.getOwnPropertySymbols,sn=Object.prototype.hasOwnProperty,an=Object.prototype.propertyIsEnumerable,Tt=(i,e,t)=>e in i?nr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Le=(i,e)=>{for(var t in e||(e={}))sn.call(e,t)&&Tt(i,t,e[t]);if(bt)for(var t of bt(e))an.call(e,t)&&Tt(i,t,e[t]);return i},Ce=(i,e)=>nr(i,"name",{value:e,configurable:!0}),on=(i,e,t)=>new Promise((r,n)=>{var s=l=>{try{o(t.next(l))}catch(u){n(u)}},a=l=>{try{o(t.throw(l))}catch(u){n(u)}},o=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,a);o((t=t.apply(i,e)).next())}),sr=class extends Ut{constructor(e){super(Le(Le({},e),{state:"loading"})),this.loadImage=Ce(r=>new Promise((n,s)=>{const a=new Image;a.addEventListener("load",()=>n(a)),a.addEventListener("error",()=>s(new Error("load failed"))),a.src=r}),"loadImage");const t=new de(e.url);t.getHeader().then(r=>{const n=e.projection===void 0?"EPSG:3857":e.projection;this.tileGrid=e.tileGrid||Gt({extent:jt(n),maxResolution:e.maxResolution,minZoom:r.minZoom,maxZoom:r.maxZoom,tileSize:e.tileSize}),this.setLoader((s,a,o)=>on(this,null,function*(){const l=yield t.getZxy(s,a,o);if(!l)return new Uint8Array;const u=URL.createObjectURL(new Blob([l.data])),h=yield this.loadImage(u);return URL.revokeObjectURL(u),h})),this.setState("ready")})}};Ce(sr,"PMTilesRasterSource");var At=sr,ar=class extends Dt{constructor(e){super(Le(Le({},e),{state:"loading",url:"pmtiles://{z}/{x}/{y}",format:e.format||new wi})),this.tileLoadFunction=Ce((t,r)=>{const n=t,s=new RegExp(/pmtiles:\/\/(\d+)\/(\d+)\/(\d+)/),a=r.match(s);if(!(a&&a.length>=4))throw Error("Could not parse tile URL");const o=+a[1],l=+a[2],u=+a[3];n.setLoader((h,c,f)=>{this.pmtiles_.getZxy(o,l,u).then(m=>{if(m){const _=n.getFormat();n.setFeatures(_.readFeatures(m.data,{extent:h,featureProjection:f})),n.setState(Oe.LOADED)}else n.setFeatures([]),n.setState(Oe.EMPTY)}).catch(m=>{n.setFeatures([]),n.setState(Oe.ERROR)})})},"tileLoadFunction"),this.pmtiles_=new de(e.url),this.pmtiles_.getHeader().then(t=>{const r=e.projection||"EPSG:3857",n=e.extent||jt(r);this.tileGrid=e.tileGrid||Gt({extent:n,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:t.maxZoom,minZoom:t.minZoom,tileSize:e.tileSize||512}),this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}};Ce(ar,"PMTilesVectorSource");var ln=ar;function P(i){return typeof i=="string"&&i.length>0}function ee(i,e,t,r=1e-8){if(typeof i!="number")return null;const n=e-r,s=t+r;return i<n||i>s?null:Math.min(Math.max(i,e),t)}function F(i){return typeof i=="object"&&i===Object(i)&&!Array.isArray(i)}function un(i){switch(i){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return i.startsWith("u")?0:null}function cn(i){switch(i){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}function or(i){const e={minimum:null,maximum:null},t=l=>l.minimum!==null&&l.maximum!==null,r=i.getMetadata("statistics");if(F(r)&&(typeof r.minimum=="number"&&(e.minimum=r.minimum),typeof r.maximum=="number"&&(e.maximum=r.maximum),t(e)))return e;const n=i.getMetadata("raster:histogram");if(F(n)&&(typeof n.min=="number"&&(e.minimum=n.min),typeof n.max=="number"&&(e.maximum=n.max),t(e)))return e;const s=i.getMetadata("classification:classes");if(Array.isArray(s)&&(s.reduce((l,u)=>(l.minimum=Math.min(l.minimum,u.value),l.maximum=Math.max(l.maximum,u.value),l),e),t(e)))return e;const a=i.getMetadata("file:values");if(Array.isArray(a)&&(a.reduce((l,u)=>(l.minimum=Math.min(l.minimum,...u.values),l.maximum=Math.max(l.maximum,...u.values),l),e),t(e)))return e;const o=i.getMetadata("data_type");return o&&(e.minimum=un(o),e.maximum=cn(o)),e}function lr(i){let e=[];const t=i.getMetadata("nodata");if(typeof t<"u")e.push(t);else{const r=i.getMetadata("file:nodata");if(typeof r<"u")e=r;else{const n=i.getMetadata("classification:classes");Array.isArray(n)&&(e=n.filter(s=>!!s.nodata).map(s=>s.value))}}return e.map(r=>r==="nan"?NaN:r==="+inf"?1/0:r==="-inf"?-1/0:r)}function re(i){let e=i.length>=6,t=i[0],r=i[e?3:2],n=i[1],s=i[e?4:3],a={west:t,east:r,south:n,north:s};return e&&(a.base=i[2],a.height=i[5]),a}function Re(i){let{west:e,east:t,south:r,north:n}=re(i);return[[[e,n],[e,r],[t,r],[t,n],[e,n]]]}function hn(i){if(i=z(i,!0),!i)return null;let e=re(i),t=[];if(hr(i)){let r=(e.west+360+e.east)/2;r>180&&(r-=360),t.push(r)}else t.push((e.west+e.east)/2);return t.push((e.south+e.north)/2),typeof e.base<"u"&&t.push((e.base+e.height)/2),t}function ur(i){if(Array.isArray(i[0]))return i.map(ur);const[e,t]=i;return[ee(e,-180,180),ee(t,-90,90)]}function Ae(i){return F(i)&&(i.bbox&&(i.bbox=z(i.bbox)),i.type==="FeatureCollection"?i.features.forEach(e=>Ae(e)):i.type==="Feature"?i.geometry=Ae(i.geometry):i.type==="GeometryCollection"?i.geometries.forEach(e=>Ae(e)):i.coordinates&&(i.coordinates=ur(i.coordinates))),i}function cr(i){if(i.every(r=>typeof r=="number")&&(i=[i]),i=i.map(r=>z(r)).filter(r=>r!==null),!Array.isArray(i)||i.length===0)return null;let e=i.reduce((r,n)=>{if(hr(n)){let{west:s,east:a,south:o,north:l}=re(n);r.push(Re([-180,o,a,l])),r.push(Re([s,o,180,l]))}else r.push(Re(n));return r},[]),t=null;if(e.length===1?t={type:"Polygon",coordinates:e[0]}:e.length>1&&(t={type:"MultiPolygon",coordinates:e}),t)return{type:"Feature",geometry:t,properties:{}}}function z(i,e=!1){if(!Array.isArray(i)||![4,6].includes(i.length))return null;let{west:t,east:r,south:n,north:s,base:a,height:o}=re(i);return t=ee(t,-180,180),n=ee(n,-90,90),r=ee(r,-180,180),s=ee(s,-90,90),e&&i.length===6?i=[t,n,a,r,s,o]:i=[t,n,r,s],i.some(l=>l===null)?null:i}function hr(i){if(i=z(i),!i)return!1;let{west:e,east:t}=re(i);return e>t}function qe(i){if(!Array.isArray(i)||i.length===0)return null;const e={west:null,south:null,east:null,north:null},t=["west","south"];for(let n of i){if(n=z(n),!n)continue;const s=re(n);for(const a in s)if(e[a]===null)e[a]=s[a];else{const o=t.includes(a)?Math.min:Math.max;e[a]=o(e[a],s[a])}}let r=[e.west,e.south,e.east,e.north];return z(r)}class ge{constructor(e,t={},r=[]){if(!F(e))throw new Error("Given data is not an object");if(e instanceof ge){for(let n of r)this[n]=e[n];e=e.toJSON()}this._keyMap=t,this._privateKeys=["_keyMap","_privateKeys"].concat(r);for(let n in e)typeof this[n]>"u"&&(n in t?this[n]=t[n](e[n],this):this[n]=e[n])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}isBand(){return!1}getObjectType(){}getAbsoluteUrl(e=!0){return null}getMetadata(e){return this[e]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return hn(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let e={};return Object.keys(this).forEach(t=>{if(typeof this[t]=="function"||this._privateKeys.includes(t))return;let r=this[t];if(t in this._keyMap){let n=Array.isArray(r)?[]:{};for(let s in r)typeof r[s].toJSON=="function"?n[s]=r[s].toJSON():n[s]=r[s];r=n}e[t]=r}),e}}const Lt=["http","https"];function fn(i,e,t=!0){return dn(i,e,!1,t)}function dn(i,e=null,t=!1,r=!0){let n=fe(i);if(e&&n.is("relative")){let s=fe(e),a=s.path();!a.endsWith("/")&&!a.endsWith(".json")&&s.path(a+"/"),n=n.absoluteTo(s)}return n.normalize(),t&&(n.query(""),n.fragment("")),r?n.toString():n}const je="application/geo+json",mn=["application/json",je,"text/json"],St=["image/gif","image/jpeg","image/apng","image/png","image/webp"],fr=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],dr=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(fr);function Xe(i,e,t=!1){return Array.isArray(e)||(e=[e]),t&&typeof i>"u"?!0:typeof i!="string"?!1:(e=e.map(r=>r.toLowerCase()),e.includes(i.toLowerCase()))}function gn(i,e=!1){return Xe(i,mn,e)}class mr extends ge{constructor(e,t=null,r={},n=[]){super(e,r,["_context"].concat(n)),this._context||(this._context=t)}getAbsoluteUrl(e=!0){return this._context?fn(this.href,this._context.getAbsoluteUrl(),e):this.href.includes("://")?e?this.href:fe(this.href):null}getContext(){return this._context}canBrowserDisplayImage(e=!1){if(typeof this.href!="string")return!1;if(!e&&typeof this.type>"u")return!1;let t=this.getAbsoluteUrl(!1);t||(t=fe(this.href));const r=t.protocol().toLowerCase(),n=t.suffix().toLowerCase();return P(r)&&!Lt.includes(r)?!1:P(this.type)&&St.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&P(n)&&(n==="jpg"||St.includes("image/"+n)))}isType(e){return P(this.type)&&Xe(this.type,e)}isGeoTIFF(){return this.isType(dr)}isCOG(){return this.isType(fr)}isHTTP(){let e=this.getAbsoluteUrl(!1);if(!e)return null;const t=e.protocol().toLowerCase();return P(t)&&Lt.includes(t)}isPreview(){return!1}}class Ye extends mr{constructor(e,t=null){super(e,t)}isLink(){return!0}getObjectType(){return"Link"}isPreview(){return this.rel==="preview"}static fromLinks(e,t=null){return Array.isArray(e)?e.map(r=>F(r)?new Ye(r,t):r):[]}}class gr extends ge{constructor(e,t=null,r={},n=[]){if(super(e,Object.assign({links:Ye.fromLinks},r),["_url"].concat(n)),!this._url&&(this._url=t,!this._url)){let s=this.getSelfLink();s&&(this._url=s.href)}}getAbsoluteUrl(e=!0){return e?this._url:fe(this._url)}setAbsoluteUrl(e){this._url=e}getStacLinksWithRel(e,t=!0){return this.getLinksWithRels([e]).filter(r=>gn(r.type,t))}getStacLinkWithRel(e,t=!0){const r=this.getStacLinksWithRel(e,t);return r.length>0?r[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(e=>F(e)&&P(e.href)):[]}getLinkWithRel(e){return this.getLinks().find(t=>t.rel===e)||null}getLinksWithRels(e){return this.getLinks().filter(t=>e.includes(t.rel))}getLinksWithOtherRels(e){return this.getLinks().filter(t=>!e.includes(t.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class Qe extends gr{constructor(e,t=null,r={},n=[]){super(e,t,r,n)}getAll(){return[]}}class te extends ge{constructor(e,t=null,r=null){super(e,{},["_index","_context"]),typeof this._index!="number"&&(this._index=typeof t=="string"?parseInt(t,10):t),this._context||(this._context=r)}getContext(){return this._context}getObjectType(){return"Band"}isBand(){return!0}getIndex(){return this._index}getMetadata(e){if(typeof this[e]<"u")return this[e];if(this._context)return this._context.getMetadata(e)}getMinMaxValues(){return or(this)}getNoDataValues(){return lr(this)}static fromBands(e,t=null){let r=[];if(Array.isArray(e))for(let n in e){const s=e[n],a=s instanceof te?s:new te(s,n,t);r.push(a)}return r}}const pn=["created","updated","published","expires","unpublished","bands"];class D extends mr{constructor(e,t=null,r=null){const n={bands:te.fromBands,alternate:D.fromAssets};super(e,r,n,["_key"]),this._key||(this._key=t)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(e=!0){return this.isDefinition()?null:super.getAbsoluteUrl(e)}getKey(){return this._key}getMetadata(e){if(typeof this[e]<"u")return this[e];if(this._context instanceof D)return this._context.getMetadata(e);if(this._context&&!pn.includes(e))return this._context.getMetadata(e)}getBands(){return this.bands||[]}findVisualBands(){const e={red:null,green:null,blue:null},t=this.getBands();for(const n in t){const s=parseInt(n,10),a=t[s];F(a)&&P(a["eo:common_name"])&&a["eo:common_name"]in e&&(e[a["eo:common_name"]]=a)}return Object.values(e).every(n=>n!==null)?e:null}findBand(e,t="name"){Array.isArray(e)||(e=[e]);const r=this.getBands(),n=r.findIndex(s=>F(s)&&e.includes(s[t]));return n>=0?r[n]:null}getBand(e){return F(e)||e===null?e:this.getBands()[e]||null}getMinMaxValues(){return or(this)}getNoDataValues(){return lr(this)}isDefinition(){return!P(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}isPreview(){const e=["thumbnail","overview"];return e.includes(this.getKey())?!0:Array.isArray(this.roles)&&this.roles.some(t=>e.includes(t))}hasRole(e,t=!1){return Array.isArray(e)||(e=[e]),t&&e.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(r=>e.includes(r))}static fromAssets(e,t=null){let r={};if(F(e))for(let n in e){const s=e[n],a=s instanceof D?s:new D(s,n,t);r[n]=a}return r}}function pr(i){if(!i)return;const e=String(i),t=e.indexOf("@"),r=t!==-1?e.substr(t+1):void 0,n=t!==-1?e.substr(0,t):e,s=String(n).replace(/-/g,"_").split("_");if(!s.length||s.length>4)return;const a=s.shift();if(!a)return;const o={keyword:r,language:a.toLowerCase()};if(!s.length)return o;if(s.length===3){const h=s.pop();h&&(o.variant=h.toUpperCase())}let l=s.pop();if(l.length>3&&(o.keyword=l,l=s.pop()),l&&(o.country=l.toUpperCase()),!s.length)return o;const u=s.pop();return typeof u=="string"&&u.length>=1&&(o.script=u[0].toUpperCase()+u.substring(1).toLowerCase()),o}function yn(i){const e={};return i.forEach(t=>{const{language:r,country:n}=pr(t);if(!r)throw new Error(`Locale ${t} is not parsable`);e[r]||(e[r]={countries:{},firstCountry:void 0,main:void 0});const s=e[r];n?(s.countries[n]=t,s.firstCountry||(s.firstCountry=t)):s.main=t}),e}function We(i,e,t,r){const n=Array.isArray(i)?yn(i):i;if(!e&&t)return We(i,t,void 0);if(!e)return;const{language:s,country:a}=pr(e);if(!s)return t;if(!n[s])return e===t?void 0:We(i,t,null);const{countries:o,main:l=t,firstCountry:u}=n[s];return!o||!a?l:o[a]?o[a]:l}class V extends gr{constructor(e,t=null,r={},n=[]){super(e,t,r,n)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getLocaleLink(e,t=null){let r=this.getStacLinksWithRel("alternate").filter(a=>P(a.hreflang)),n;Array.isArray(this.languages)?n=this.languages.map(a=>a.code):n=r.map(a=>a.hreflang);let s=We(n,e,t);return r.find(a=>a.hreflang===s)||null}getIcons(e=!0){return this.getLinksWithRels(["icon"]).filter(t=>t.canBrowserDisplayImage(e))}getThumbnails(e=!0,t=null){let r=this.getAssets().filter(n=>n.isPreview());if(r.length===0&&(r=this.getLinks().filter(n=>n.isPreview())),r.length===0){const n=this.getAsset("thumbnail");n&&r.push(n)}if(e&&(r=r.filter(n=>n.canBrowserDisplayImage())),t&&r.length>1){let n=s=>Array.isArray(s.roles)&&s.roles.includes(t)||s.getKey()===t;r=r.filter(n).concat(r.filter(s=>!n(s)))}return r}getDefaultGeoTIFF(e=!0,t=!1){return this.rankGeoTIFFs(e,t)[0]?.asset}rankGeoTIFFs(e=!0,t=!1,r=null,n=null){F(r)||(r={data:1,visual:2,thumbnail:2,overview:3});let s=[],a=this.getAssetsByTypes(dr);e&&(a=a.filter(l=>l.isHTTP()&&(!t||l.isCOG())));let o=Object.entries(r);for(let l of a){let u=0;if(o.length>0){let h=o.filter(([c])=>l.hasRole(c,!0)).map(([,c])=>c);h.length>0&&(u+=Math.max(...h))}!t&&l.isCOG()&&(u+=2),l.findVisualBands()&&(u+=1),typeof n=="function"&&(u+=n(l)),s.push({asset:l,score:u})}return s.sort((l,u)=>u.score-l.score),s}findVisualAssets(){let e={red:null,green:null,blue:null},t=Object.keys(e),r=this.getAssets();for(let s of r){let a=s.findBand(t,"eo:common_name");a&&(e[a["eo:common_name"]]=s)}return Object.values(e).every(s=>s!==null)?e:null}getAsset(e){return F(this.assets)&&this.assets[e]||null}getAssets(){return F(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(e,t=!1){return this.getAssets().filter(r=>r.hasRole(e,t))}getAssetWithRole(e,t=!1){return this.getAssetsWithRoles([e],t)[0]||null}getAssetsByTypes(e){return this.getAssets().filter(t=>Xe(t.type,e))}equals(e){return this===e?!0:!(e instanceof V)||this.getObjectType()!==e.getObjectType()?!1:!!(this.id&&this.id===e.id)}supportsExtension(e){if(!Array.isArray(this.stac_extensions))return!1;let t=new RegExp("^"+e.replaceAll("*","[^/]+")+"$");return this.stac_extensions.some(r=>t.test(r))}}class yr extends V{constructor(e,t=null,r={},n=[]){super(e,t,r,n)}getObjectType(){return this.type}getSearchLink(e=null){let t=this.getStacLinksWithRel("search");return e?t[0]||null:t.find(r=>r.method===e||!e&&!r.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class _n extends yr{constructor(e,t=null){super(e,t)}}function ue(i){if(P(i)&&i.length>=10)try{let t=i.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(r=>parseInt(r,10));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]||0))}catch{return null}return null}function wn(i,e){return new Date(i.valueOf()+(e-i)/2)}function _r(i){if(!Array.isArray(i)||i.length===0)return null;let e,t;const r=(n,s,a)=>typeof n>"u"?s:n===null||s===null?null:a(n,s);return i.forEach(([n,s])=>{e=r(e,n,Math.min),t=r(t,s,Math.max)}),[e===null?null:new Date(e),t===null?null:new Date(t)]}class Ve extends yr{constructor(e,t=null){const r={assets:D.fromAssets,item_assets:D.fromAssets};super(e,t,r)}toGeoJSON(){let e=cr(this.getBoundingBoxes());return e&&(e.id=this.id),e}getBoundingBox(){let e=this.getRawBoundingBoxes();return e.length>0?z(e[0]):null}getBoundingBoxes(){let e=this.getRawBoundingBoxes();return e.length===1?[z(e[0])]:e.length>1?e.slice(1).map(z):null}getRawBoundingBoxes(){let e=this.extent?.spatial?.bbox;return Array.isArray(e)&&e.length>0?e:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let e=this.extent?.temporal?.interval;return Array.isArray(e)&&e.length>0?e.filter(t=>Array.isArray(t)&&(P(t[0])||P(t[1]))).map(t=>t.map(r=>ue(r))):[]}getSummary(e){if(F(this.summaries))return this.summaries[e]}getBands(){let e=this.getMetadata("bands");return Array.isArray(e)||(e=this.getSummary("bands")),Array.isArray(e)?te.fromBands(e,this):[]}}class wr extends Qe{constructor(e,t=null){const r={collections:n=>n.map(s=>s instanceof Ve?s:new Ve(s))};super(e,t,r)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return qe(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return _r(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class Se extends V{constructor(e,t=null){super(e,t,{assets:D.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return z(this.bbox)}getBoundingBoxes(){const e=this.getBoundingBox();return e?[e]:[]}getDateTime(){let e=ue(this.properties.datetime);if(!e){let t=ue(this.properties.start_datetime),r=ue(this.properties.end_datetime);return t&&r?wn(t,r):t||r}return e}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let e=[];return P(this.properties.start_datetime)||P(this.properties.end_datetime)?e=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:P(this.properties.datetime)&&(e=[[this.properties.datetime,this.properties.datetime]]),e.map(t=>t.map(r=>ue(r)))}getMetadata(e){return this.properties[e]}getBands(){const e=this.getMetadata("bands");return Array.isArray(e)?te.fromBands(e,this):[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class vr extends Qe{constructor(e,t=null){const r={features:n=>n.map(s=>s instanceof Se?s:new Se(s))};super(e,t,r)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return qe(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return _r(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function Te(i,e=!0,t=!1){return e&&(i=Mr.stac(i,t)),i.type==="Feature"?new Se(i):i.type==="FeatureCollection"?new vr(i):i.type==="Collection"||!i.type&&typeof i.extent<"u"&&typeof i.license<"u"?new Ve(i):!i.type&&Array.isArray(i.collections)?new wr(i):new _n(i)}class vn extends Bt{constructor(e){super(jr.ERROR),this.error=e}}const xn="https://stac-extensions.github.io/label/v1.*/schema.json",xr=new Rt({color:"rgba(0,0,0,0)"});function et(i,e,t="rgba(255,255,255,0.4)",r=5){let n=xr;t&&(n=new Rt({color:t}));const s=new Wr({color:i,width:e});return new Vr({image:new zr({fill:n,stroke:s,radius:r}),fill:n,stroke:s})}const bn=et("#3399CC",3),Mt=et("#ff9933",2,null);async function Tn(i,e=null,t=null,r=0){const n=new Set;return i.map.forEachFeatureAtPixel(i.pixel,(s,a)=>{t&&t.push(s),n.add(a.get("stac"))},{hitTolerance:r,layerFilter(s){if(s instanceof ze&&s.get("bounds")===!0){const a=s.get("stac");if(a instanceof V&&(!e||!a.equals(e)))return!0}return!1}}),[...n]}function An(i,e){const t={url:i.getAbsoluteUrl()};let r=i,n=i.getBands();n.length===1&&(r=n[0],n=[]);const{minimum:s,maximum:a}=r.getMinMaxValues();if(typeof s=="number"&&(t.min=s),typeof a=="number"&&(t.max=a),typeof t.min!="number"&&typeof t.max!="number"&&n.length>1)for(const l of n){const{minimum:u,maximum:h}=l.getMinMaxValues();typeof u=="number"&&(typeof t.min>"u"||u<t.min)&&(t.min=u),typeof h=="number"&&(typeof t.max>"u"||h>t.max)&&(t.max=h)}const o=r.getNoDataValues();if(o.length>0)t.nodata=o[0];else if(n.length>1){let l;for(const u of n){const h=u.getNoDataValues();if(h.length>0){if(typeof l>"u")l=h[0];else if(l!==h[0]){l=void 0;break}}}typeof l<"u"&&(t.nodata=l)}if(e.length>0)t.bands=e;else{const l=i.findVisualBands();l&&(t.bands=[l.red.getIndex()+1,l.green.getIndex()+1,l.blue.getIndex()+1])}return t}async function br(i){try{const{fromProjectionCode:e,fromEPSGCode:t}=await le(async()=>{const{fromProjectionCode:r,fromEPSGCode:n}=await import("./GeoJSON-CeOkJNhj.js").then(s=>s.ca);return{fromProjectionCode:r,fromEPSGCode:n}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9]));return typeof e=="function"?await e(i):await t(i)}catch{return null}}async function Ct(i,e=void 0){let t;if(Nr()){const r=i.getMetadata("proj:code");r&&(t=await br(r))}return t||e}function Et(i,e){const t=i.clone();return e.hasOnlyBounds()||t.setFill(xr),t}function Ln(i){let e=i.href;if(e.includes("{s}"))if(Array.isArray(i["href:servers"])&&i["href:servers"].length>0){const t=Math.random()*i["href:servers"].length|0;e=e.replace("{s}",i["href:servers"][t])}else return null;return e}function It(i){return typeof i=="string"||typeof i=="number"||typeof i=="boolean"}function Sn(i){return((i.fileDirectory.NewSubfileType||0)&4)===4}function Mn(i,e){if(!i)return!1;if(i===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,r=Ai;return t===r.CMYK||t===r.YCbCr||t===r.CIELab||t===r.ICCLab}const Ft="STATISTICS_MAXIMUM",Ot="STATISTICS_MINIMUM",ke=256;let De;function Cn(){return De||(De=new Ti),De}function En(i){try{return i.getBoundingBox(!0)}catch{return[0,0,i.getWidth(),i.getHeight()]}}function In(i){try{return i.getOrigin().slice(0,2)}catch{return[0,i.getHeight()]}}function Fn(i,e){try{return i.getResolution(e)}catch{return[e.getWidth()/i.getWidth(),e.getHeight()/i.getHeight()]}}async function Pt(i,e,t,r){const n=i[e];if(n&&n!==32767){const s="EPSG:"+n;let a=ei(s);if(!a&&r&&(a=await br(s)),!a){const o=ti(i[t]);o&&(a=new ri({code:s,units:o}))}return a||null}}async function On(i,e){const t=i.geoKeys;if(!t)return null;const r=await Pt(t,"ProjectedCSTypeGeoKey","ProjLinearUnitsGeoKey",e);return r||await Pt(t,"GeographicTypeGeoKey","GeogAngularUnitsGeoKey",e)}function Pn(i){return i.getImageCount().then(function(e){const t=new Array(e);for(let r=0;r<e;++r)t[r]=i.getImage(r);return Promise.all(t)})}function Bn(i,e){let t;return i.blob?t=vi(i.blob):i.overviews?t=xi(i.url,i.overviews,e):t=bi(i.url,e),t.then(Pn)}function ce(i,e,t,r,n){if(Array.isArray(i)){const s=i.length;if(!Array.isArray(e)||s!=e.length){const a=new Error(r);throw n(a),a}for(let a=0;a<s;++a)ce(i[a],e[a],t,r,n);return}if(e=e,Math.abs(i-e)>t*i)throw new Error(r)}function Rn(i){return i instanceof Int8Array?-128:i instanceof Int16Array?-32768:i instanceof Int32Array?-2147483648:i instanceof Float32Array?12e-39:0}function kn(i){return i instanceof Int8Array?127:i instanceof Uint8Array||i instanceof Uint8ClampedArray?255:i instanceof Int16Array?32767:i instanceof Uint16Array?65535:i instanceof Int32Array?2147483647:i instanceof Uint32Array?4294967295:i instanceof Float32Array?34e37:255}class Tr extends Ut{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.loadMissingProjection_=e.loadMissingProjection||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const r=this,n=new Array(t);for(let s=0;s<t;++s)n[s]=Bn(this.sourceInfo_[s],this.sourceOptions_);Promise.all(n).then(function(s){return r.configure_(s)}).catch(function(s){pt(s),r.error_=s,r.setState("error")})}getError(){return this.error_}async determineProjection(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const n=t[r],s=await On(n,this.loadMissingProjection_);if(s){this.projection=s;break}}}determineTransformMatrix(e){const t=e[0];for(let r=t.length-1;r>=0;--r){const s=t[r].fileDirectory.ModelTransformation;if(s){const[a,o,l,u,h,c,f,m]=s,_=yt(yt([1/Math.sqrt(a*a+h*h),0,0,-1/Math.sqrt(o*o+c*c),u,m],[a,h,o,c,0,0]),[1,0,0,1,-u,-m]);this.transformMatrix=_,this.addAlpha_=!0;break}}}async configure_(e){let t,r,n,s,a;const o=new Array(e.length),l=new Array(e.length),u=new Array(e.length);let h=0;const c=e.length;for(let d=0;d<c;++d){const g=[],w=[];e[d].forEach(x=>{Sn(x)?w.push(x):g.push(x)});const y=g.length;if(w.length>0&&w.length!==y)throw new Error(`Expected one mask per image found ${w.length} masks and ${y} images`);let O,I;const W=new Array(y),A=new Array(y),C=new Array(y);l[d]=new Array(y),u[d]=new Array(y);for(let x=0;x<y;++x){const S=g[x],M=S.getGDALNoData();u[d][x]=S.getGDALMetadata(0),l[d][x]=M;const U=this.sourceInfo_[d].bands;o[d]=U?U.length:S.getSamplesPerPixel();const ie=y-(x+1);O||(O=En(S)),I||(I=In(S));const ne=Fn(S,g[0]);C[ie]=ne[0];const G=[S.getTileWidth(),S.getTileHeight()];G[0]!==G[1]&&G[1]<ke&&(G[0]=ke,G[1]=ke),W[ie]=G;const N=ne[0]/Math.abs(ne[1]);A[ie]=[G[0],G[1]/N]}if(t?Xr(t,O,t):t=O,!r)r=I;else{const x=`Origin mismatch for source ${d}, got [${I}] but expected [${r}]`;ce(r,I,0,x,this.viewRejector)}if(!a)a=C,this.resolutionFactors_[d]=1;else{a.length-h>C.length&&(h=a.length-C.length);const x=a[a.length-1]/C[C.length-1];this.resolutionFactors_[d]=x;const S=C.map(U=>U*=x),M=`Resolution mismatch for source ${d}, got [${S}] but expected [${a}]`;ce(a.slice(h,a.length),S,.02,M,this.viewRejector)}n?ce(n.slice(h,n.length),A,.01,`Tile size mismatch for source ${d}`,this.viewRejector):n=A,s?ce(s.slice(h,s.length),W,0,`Tile size mismatch for source ${d}`,this.viewRejector):s=W,this.sourceImagery_[d]=g.reverse(),this.sourceMasks_[d]=w.reverse()}for(let d=0,g=this.sourceImagery_.length;d<g;++d){const w=this.sourceImagery_[d];for(;w.length<a.length;)w.unshift(void 0)}this.getProjection()||await this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=o,this.nodataValues_=l,this.metadata_=u;e:for(let d=0;d<c;++d){if(this.sourceInfo_[d].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[d].length){this.addAlpha_=!0;break}const g=l[d],w=this.sourceInfo_[d].bands;if(w){for(let y=0;y<w.length;++y)if(g[w[y]-1]!==null){this.addAlpha_=!0;break e}continue}for(let y=0;y<g.length;++y)if(g[y]!==null){this.addAlpha_=!0;break e}}let f=this.addAlpha_?1:0;for(let d=0;d<c;++d)f+=o[d];this.bandCount=f;const m=new Li({extent:t,minZoom:h,origin:r,resolutions:a,tileSizes:n});this.tileGrid=m,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const _=1;a.length===2?a=[a[0],a[1],a[1]/2]:a.length===1&&(a=[a[0]*2,a[0],a[0]/2]);let p=t;if(this.transformMatrix){const d=Zr(Hr(),this.transformMatrix.slice()),g=Qr(w=>ii(d,w));p=$r(t,g)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:a,center:Kr(qr(p),this.projection),extent:Jr(p,this.projection),zoom:_})}loadTile_(e,t,r,n){const s=this.getTileSize(e),a=this.sourceImagery_.length,o=new Array(a*2),l=this.nodataValues_,u=this.sourceInfo_,h=Cn();for(let c=0;c<a;++c){const f=u[c],m=this.resolutionFactors_[c],_=[Math.round(t*(s[0]*m)),Math.round(r*(s[1]*m)),Math.round((t+1)*(s[0]*m)),Math.round((r+1)*(s[1]*m))],p=this.sourceImagery_[c][e];let d;f.bands&&(d=f.bands.map(function(I){return I-1}));let g;"nodata"in f&&f.nodata!==null?g=f.nodata:d?g=d.map(function(I){return l[c][I]}):g=l[c];const w={window:_,width:s[0],height:s[1],samples:d,fillValue:g,pool:h,interleave:!1,signal:n.signal};Mn(this.convertToRGB_,p)?o[c]=p.readRGB(w):o[c]=p.readRasters(w);const y=a+c,O=this.sourceMasks_[c][e];if(!O){o[y]=Promise.resolve(null);continue}o[y]=O.readRasters({window:_,width:s[0],height:s[1],samples:[0],pool:h,interleave:!1})}return Promise.all(o).then(this.composeTile_.bind(this,s)).catch(function(c){throw pt(c),c})}composeTile_(e,t){const r=this.metadata_,n=this.sourceInfo_,s=this.sourceImagery_.length,a=this.bandCount,o=this.samplesPerPixel_,l=this.nodataValues_,u=this.normalize_,h=this.addAlpha_,c=e[0]*e[1],f=c*a;let m;u?m=new Uint8Array(f):m=new Float32Array(f);let _=0;for(let p=0;p<c;++p){let d=h;for(let g=0;g<s;++g){const w=n[g];let y=w.min,O=w.max,I,W;if(u){const A=r[g][0];y===void 0&&(A&&Ot in A?y=parseFloat(A[Ot]):y=Rn(t[g][0])),O===void 0&&(A&&Ft in A?O=parseFloat(A[Ft]):O=kn(t[g][0])),I=255/(O-y),W=-y*I}for(let A=0;A<o[g];++A){const C=t[g][A][p];let x;if(u?x=Yr(I*C+W,0,255):x=C,!h)m[_]=x;else{let S=w.nodata;if(S===void 0){let U;w.bands?U=w.bands[A]-1:U=A,S=l[g][U]}const M=isNaN(S);(!M&&C!==S||M&&!isNaN(C))&&(d=!1,m[_]=x)}_++}if(!d){const A=s+g,C=t[A];C&&!C[0][p]&&(d=!0)}}h&&(d||(m[_]=255),_++)}return m}}Tr.prototype.getView;class b{constructor(e){this.name=e}toString(){return this.name}}b.GeoTIFF=new b("GeoTIFF");b.ImageStatic=new b("ImageStatic");b.PMTilesRaster=new b("PMTilesRaster");b.PMTilesVector=new b("PMTilesVector");b.TileJSON=new b("TileJSON");b.TileWMS=new b("TileWMS");b.WMTS=new b("WMTS");b.XYZ=new b("XYZ");class tt extends ni{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(r=>t[r]=e[r]),super(t),this.getSourceOptions_=e.getSourceOptions,this.children_=null,this.childrenOptions_=e.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||bn,this.collectionStyle_=e.collectionStyle||Mt,this.boundsLayer_=null,this.disableMigration_=e.disableMigration||!1,this.map_=null,this.eventQueue_=[],e.httpRequestFn&&(this.fetch_=e.httpRequestFn),e.data){try{this.configure_(e.data,e.url,e.children,e.assets,e.bands)}catch(r){this.handleError_(r)}return}if(!e.url)throw new Error("Either url or data must be provided");this.fetch_(e.url).then(r=>this.configure_(r,e.url,e.children,e.assets,e.bands)).catch(r=>this.handleError_(r))}async fetch_(e,t="json"){const r=await fetch(e);if(!r.ok)throw new Error(`Unexpected response from ${e}: ${r.status}`);return t==="json"?await r.json():t==="text"?await r.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var e;if(this.getLayers().getLength()>1)return!1;const r=(e=this.getData())===null||e===void 0?void 0:e.getBoundingBox();return!r||si(r)?!0:!this.boundsLayer_||!this.displayFootprint_}handleError_(e){this.dispatch_(new vn(e))}configure_(e,t=null,r=null,n=null,s=[]){let a;e instanceof D||e instanceof V?a=e:(a=Te(e,!this.disableMigration_),t&&t.includes("://")&&a.setAbsoluteUrl(t)),this.set("stac",a),this.bands_=s,this.boundsLayer_=this.addFootprint_();const o=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Et(this.boundsStyle_,this))};this.getLayers().on("add",o),this.getLayers().on("remove",o);const l=h=>this.handleError_(h),u=[];r&&u.push(this.setChildren(r,null,!1).catch(l)),n&&u.push(this.setAssets(n,!1).catch(l)),Promise.all(u).then(()=>this.updateLayers().catch(l)),this.dispatch_("sourceready")}dispatch_(e){this.eventQueue_.push(e),this.flush_()}flush_(){if(this.map_){for(const e of this.eventQueue_)this.dispatchEvent(e);this.eventQueue_=[]}}setMap_(e){this.map_!==e&&(this.map_=e,this.flush_())}async addChildren_(e,t={}){const r=e.map(n=>{const s={data:n,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},a=new tt(Object.assign(s,t));return a.on("sourceready",()=>{a.map_&&this.setMap_(a.map_)}),this.addLayer_(a,null),a});return await Promise.all(r)}async addPreviewImage_(e){const t=await Ct(e,"EPSG:4326"),r=e.getContext().getBoundingBoxes();if(r.length!==1)return;const n=r[0];let s={url:e.getAbsoluteUrl(),projection:t,imageExtent:_t(n,"EPSG:4326",t),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(s=await this.getSourceOptions_(b.ImageStatic,s,e));const a=new fi({source:new mi(s)});return this.addLayer_(a,e),a}async addLayerForLink(e){const t=Ln(e);if(!t)return;const r={attributions:e.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},n=async(a,o)=>(this.getSourceOptions_&&(o=await this.getSourceOptions_(a,o,e)),o),s=[];switch(e.rel){case"pmtiles":const o=await new de(r.url).getHeader();let l;switch(o.tileType){case Y.Mvt:l=new ln(await n(b.PMTilesVector,r));break;case Y.Avif:case Y.Jpeg:case Y.Png:case Y.Webp:l=new At(await n(b.PMTilesRaster,r));break;default:return}s.push(l);break;case"tilejson":s.push(new gi(await n(b.TileJSON,r)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const c in e["wms:layers"]){const f=e["wms:layers"][c]||"";let m="";Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][c]=="string"&&(m=e["wms:styles"][c]);const _=Object.assign({LAYERS:f,STYLES:m},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(_.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(_.FORMAT=e.type);const p=await n(b.TileWMS,Object.assign({},r,{params:_}));s.push(new pi(p))}break;case"wmts":const u=await this.getWmtsCapabilities_(t,e["wmts:encoding"]);if(!u)return;let h=[];Array.isArray(e["wmts:layer"])?h=e["wmts:layer"]:typeof e["wmts:layer"]=="string"&&(h=[e["wmts:layer"]]);for(const c of h){let f=Object.assign({},r,{layer:c,requestEncoding:e["wmts:encoding"]==="rest"?"REST":"KVP"});typeof e.type=="string"&&e.type.startsWith("image/")&&(f.format=e.type),f=await n(b.WMTS,f);const m=_i(u,f);if(m!==null){if(typeof e.uriTemplate=="string"){let _=e.uriTemplate;const p=F(e.variables)?e.variables:{};for(const d in p){const g=p[d];let w;if(It(g.const)?w=g.const:It(g.default)?w=g.default:Array.isArray(g.enum)&&g.enum.length>0&&(w=g.enum[0]),typeof w<"u")_=_.replaceAll(`{${d}}`,String(w));else continue}delete m.urls,m.url=_}s.push(new yi(m))}}break;case"xyz":s.push(new xt(await n(b.XYZ,r)));break;default:return}return s.map(a=>{let o;return a instanceof Dt?o=new di({source:a,declutter:!0}):a instanceof At?o=new vt({source:a}):o=new wt({source:a}),this.addLayer_(o,e),o})}async addGeoTiff_(e){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let r={sources:[An(e,this.bands_)],convertToRGB:"auto",loadMissingProjection:!0};const n=await Ct(e);n&&(r.projection=n),this.getSourceOptions_&&(r=await this.getSourceOptions_(b.GeoTIFF,r,e));const s=new Tr(r),a=new Promise((o,l)=>{s.on("error",l),s.on("change",()=>{s.getState()==="error"?l(s.getError()):o()})});try{await a;const o=new vt({source:s});return this.addLayer_(o,e),o}catch(o){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);this.handleError_(o)}}async addTileLayerForImagery_(e){let t=this.buildTileUrlTemplate_(e);t instanceof Promise&&(t=await t);let r={crossOrigin:this.crossOrigin_,url:t};this.getSourceOptions_&&(r=await this.getSourceOptions_(b.XYZ,r,e));const n=new wt({source:new xt(r)});return this.addLayer_(n,e),n}addLayer_(e,t=null,r=0){t&&e.set("stac",t),e.setZIndex(r),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=cr(t.getBoundingBox()):e=t.toGeoJSON(),e){const r=this.createGeoJsonLayer_(e,Et(this.boundsStyle_,this),this.displayFootprint_);return r.set("bounds",!0),r.on("change",()=>this.setMap_(r.getMapInternal())),this.addLayer_(r,t,1),r}return null}async addGeoJson_(e){try{const t=await this.fetch_(e.getAbsoluteUrl()),r=this.createGeoJsonLayer_(t);return this.addLayer_(r,e),r}catch(t){this.handleError_(t)}}createGeoJsonLayer_(e,t=null,r=!0){const n=new kt,s=new ai({format:n,loader:(a,o,l)=>{e=Ae(e);const u=n.readFeatures(e,{featureProjection:l});s.addFeatures(u)}});return t||(t=Mt),new ze({source:s,style:t,visible:r})}async addLabelExtension_(){const e=this.getData();if(!(e instanceof Se))return;let t=e.getAssetsWithRoles(["labels","labels-vector"],!0),r;t.length>1&&(r=t.find(s=>s.roles.includes("labels-vector"))),r||(r=e.getAsset("vector_labels")),r||(t=e.getAssets().filter(s=>s.type===je&&!s.roles),t.length===1&&(r=t[0]));const n=e.getLinksWithRels(["source"]);if(r&&n.length>0){const s=n.map(async o=>{try{const l=await this.fetch_(o.getAbsoluteUrl());return Te(l)}catch(l){return this.handleError_(l),null}}),a=(await Promise.all(s)).filter(o=>o instanceof V);await this.addChildren_(a,{displayFootprint:!1})}try{await this.addGeoJson_(r)}catch(s){this.handleError_(s)}}async updateLayers(e=!0){const t=this.getLayers();for(let s=t.getLength()-1;s>=0;s--){const a=t.item(s);a.get("stac")&&!a.get("bounds")&&t.removeAt(s)}const r=this.getData();if(Array.isArray(this.displayWebMapLink_)){const s=this.getWebMapLinks().map(async a=>await this.addLayerForLink(a));await Promise.all(s)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const n=this.getAssets();if(n){const s=n.map(async a=>{if(a){if(a.type===je)return await this.addGeoJson_(a);if(a.isGeoTIFF())return await this.addGeoTiff_(a);if(a.canBrowserDisplayImage())return await this.addPreviewImage_(a)}});await Promise.all(s)}if(this.hasOnlyBounds()){if(r instanceof Qe)await this.addChildren_(r.getAll(),this.childrenOptions_);else if(r instanceof V){if(r.isItem()&&r.supportsExtension(xn)&&r.getMetadata("label:type")==="vector"){await this.addLabelExtension_(),e&&this.dispatch_("layersready");return}const s=this.getWebMapLinks();if(s.length>0)await this.addLayerForLink(s[0]);else{const a=r.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let o;if(a&&this.displayOverview_&&(o=await this.addGeoTiff_(a)),this.displayPreview_&&(!a||!o)){const l=r.getThumbnails(!0,"overview");l.length>0&&await this.addPreviewImage_(l[0])}}}}e&&this.dispatch_("layersready")}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(r=>r!==e)>"u"}getWebMapLinks(){const e=this.getData();if(e instanceof D)return[];let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);let r=e.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?r=this.displayWebMapLink_.map(n=>{if(typeof n=="string"){const s=r.find(a=>a.id===n);return s||null}return n}).filter(n=>!!n):r.sort((n,s)=>{const a=t.indexOf(n.rel),o=t.indexOf(s.rel);return a-o}),r}async setAssets(e,t=!0){if(e!==this.assets_){if(Array.isArray(e)){const r=this.getData();this.assets_=e.map(n=>r instanceof V&&typeof n=="string"?r.getAsset(n):n instanceof D?n:new D(n))}else this.assets_=null;t&&await this.updateLayers()}}async setChildren(e,t=null,r=!0){e instanceof vr?this.children_=e.getAll():e instanceof wr?this.children_=e.getAll():F(e)&&e.type==="FeatureCollection"?this.children_=Te(e,!this.disableMigration_).getAll():Array.isArray(e)?this.children_=e.map(n=>n instanceof V?n:Te(n,!this.disableMigration_)):this.children_=null,this.children_&&this.children_.length===0&&(this.children_=null),this.children_&&F(t)&&(this.childrenOptions_=t),r&&await this.updateLayers()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const e=this.map_.getView();if(!e)return;let t;const r=this.getData();r&&(t=r.getBoundingBox());const n=this.getChildren();if(n){const s=n.map(a=>a.getBoundingBox());t=qe(s)}if(t)return _t(t,"EPSG:4326",e.getProjection())}getLayerState(){const e=super.getLayerState();return e.extent=void 0,e}getAttributions(){const e=[],t=this.getData();if(t){const r=t.getMetadata("attribution");r&&r.push(r)}return e}getSource(){return null}async getWmtsCapabilities_(e,t="kvp"){try{const r=new URL(e);t!=="rest"&&(r.searchParams.set("service","wmts"),r.searchParams.set("request","GetCapabilities"));const n=await this.fetch_(r.toString(),"text");return new hi().read(n)}catch{return null}}}const Dn=et("#ff0000",2,null);let Un=0;const Gn={name:"MapView",components:{BPopover:_e(()=>le(()=>import("./bootstrap-vue-next-C6nJgSTY.js"),__vite__mapDeps([10,1,2,3,4,5,11,12,13,14,15,8,16,17,18,19,20,21,22,7,23,24,6,25,26,27])).then(i=>i.BPopover)),Features:_e(()=>le(()=>import("./Features-DKxCWDAB.js"),__vite__mapDeps([28,1,2,3,4,5,15,8,18,29,30,31]))),Catalogs:_e(()=>le(()=>import("./Catalogs-B03kkeYL.js").then(i=>i.b),__vite__mapDeps([32,1,2,3,4,5,15,8,33,34,30,31,18,19,35,36,37]))),Items:_e(()=>le(()=>import("./Items-0oQmoZAX.js"),__vite__mapDeps([38,1,2,3,4,5,15,8,14,33,34,30,31,18,19,35,36]))),LayerControl:ui,TextControl:li},mixins:[oi],props:{stac:{type:Object,default:null},assets:{type:Array,default:null},children:{type:Object,default:null},onfocusOnly:{type:Boolean,default:!1},popover:{type:Boolean,default:!1}},emits:["empty","changed"],data(){return{selection:null,clickPosition:{x:0,y:0},empty:!1,selector:null,mapId:`map-${++Un}`}},computed:{...Pr(["getStac"]),container(){return this.isFullScreen?"#"+this.mapId:"#stac-browser"},childrenOptions(){return{displayPreview:this.children&&this.children.isItemCollection()}}},watch:{async stac(){await this.showStacLayer()},async assets(){this.stacLayer&&await this.stacLayer.setAssets(this.assets)},async children(){this.stacLayer&&(await this.stacLayer.setAssets(null,!1),await this.stacLayer.setChildren(this.children,this.childrenOptions,!1),await this.stacLayer.updateLayers(),this.fit())},empty(i){i&&this.$emit("empty")},selection(i){!i&&this.selector&&this.selector.getFeatures().clear()}},created(){this.stacLayer=null},async mounted(){await this.showStacLayer()},methods:{async showStacLayer(){this.map=null,this.stacLayer=null,await this.createMap(this.$refs.map,this.stac,this.onfocusOnly),this.stac&&await this.addStacLayer()},async addStacLayer(){let i=Object.assign({},this.stacLayerOptions,{data:this.stac,children:this.children,assets:this.assets||null,displayWebMapLink:!0,disableMigration:!0,childrenOptions:this.childrenOptions});this.stacLayer=new tt(i),this.stacLayer.on("error",e=>{console.warn(e),this.fit()}),this.stacLayer.on("sourceready",this.fit),this.stacLayer.on("layersready",()=>{this.empty=this.stacLayer.isEmpty(),this.$emit("changed",this.getShownData())}),this.map.addLayer(this.stacLayer),this.popover&&(this.selector=new Ne({multi:!0,style:Dn,layers:e=>{if(this.children)return!1;{const t=e.get("stac");return t&&t.isAsset()}}}),this.selector.on("select",e=>{this.selection=null,this.setTargetPosition(e.mapBrowserEvent);const t=this.selector.getFeatures();if(t.getLength()>0){const r=new kt;this.selection={target:this.$refs.target,type:"features",items:t.getArray().map(n=>r.writeFeatureObject(n))}}}),this.map.addInteraction(this.selector),this.map.on("singleclick",async e=>{if(this.selection=null,this.children){this.setTargetPosition(e),this.selector.getFeatures().clear();const t=this.selector.getFeatures(),r=this.stacLayer.getData(),n=await Tn(e,r,t,5);n.length>0&&(this.selection={target:this.$refs.target,type:this.children.isCollectionCollection()?"collections":"items",children:n})}}),this.map.on("change",()=>this.selection=null),this.map.on("movestart",()=>this.selection=null))},setTargetPosition(i){this.$refs.target.style.left=i.pixel[0]+"px",this.$refs.target.style.top=i.pixel[1]+"px"},fit(){const i=this.stacLayer.getExtent();i&&(this.map.updateSize(),this.map.getView().fit(i,{padding:[50,50,50,50],maxZoom:this.maxZoom}))},resetSelection(){this.selection=null},getShownData(){return this.stacLayer?this.stacLayer.getLayers().getArray().filter(i=>ci.isLayerVisible(i)).map(i=>i.get("stac")).filter(i=>i instanceof Or):null}}},jn={class:"map-container"},Wn=["id"],Vn={ref:"target",class:"popover-target"},zn={class:"popover-children"},Nn={class:"text-center"};function Zn(i,e,t,r,n,s){const a=K("LayerControl"),o=K("TextControl"),l=K("Items"),u=K("Catalogs"),h=K("Features"),c=Ir,f=K("b-popover");return $(),Er("div",jn,[ye("div",{ref:"map",class:"map",id:n.mapId},[ut(a,{map:i.map,maxZoom:i.maxZoom},null,8,["map","maxZoom"]),e[0]||(e[0]=ae()),n.empty?($(),q(o,{key:0,map:i.map,text:i.$t("mapping.nodata")},null,8,["map","text"])):i.hasBasemap?ct("",!0):($(),q(o,{key:1,map:i.map,text:i.$t("mapping.nobasemap")},null,8,["map","text"]))],8,Wn),e[2]||(e[2]=ae()),ye("div",Vn,null,512),e[3]||(e[3]=ae()),t.popover&&n.selection?($(),q(f,{key:0,show:"",manual:"",placement:"auto",target:n.selection.target,"teleport-to":s.container,class:"map-popover","boundary-padding":10},{default:ht(()=>[ye("section",zn,[n.selection.type==="items"?($(),q(l,{key:0,stac:t.stac,items:n.selection.children},null,8,["stac","items"])):n.selection.type==="collections"?($(),q(u,{key:1,collectionsOnly:"",enforceCards:"",hideControls:"",stac:t.stac,catalogs:n.selection.children},null,8,["stac","catalogs"])):($(),q(h,{key:2,features:n.selection.children},null,8,["features"]))]),e[1]||(e[1]=ae()),ye("div",Nn,[ut(c,{variant:"danger",onClick:s.resetSelection},{default:ht(()=>[ae(Fr(i.$t("mapping.close")),1)]),_:1},8,["onClick"])])]),_:1},8,["target","teleport-to"])):ct("",!0)])}const Xs=Cr(Gn,[["render",Zn]]);export{Xs as default};
//# sourceMappingURL=MapView-M2jne4eP.js.map
